{"version":3,"sources":["webpack:///webpack/bootstrap e989107d1a45fef7b643","webpack:///./src/index.js","webpack:///external \"bluebird\"","webpack:///external \"circular-json\""],"names":["CircularJSON","require","module","exports","init","bp","ready","getRouter","post","req","res","code","body","status","send","message","fromDate","Date","handleResult","logger","query","from","until","order","fields","err","results","success","logs","file","result","stringify","fn","Function","db","get","then","method","call","knex","catch"],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;ACtCA;;;;;;AAEA,KAAMA,eAAe,mBAAAC,CAAQ,CAAR,CAArB;;AAEAC,QAAOC,OAAP,GAAiB;AACfC,SAAM,cAASC,EAAT,EAAa,CAElB,CAHc;AAIfC,UAAO,eAASD,EAAT,EAAa;;AAElBA,QAAGE,SAAH,CAAa,mBAAb,EACCC,IADD,CACM,MADN,EACc,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC1B,WAAMC,OAAOF,IAAIG,IAAJ,IAAYH,IAAIG,IAAJ,CAASD,IAAlC;;AAEA,WAAI,CAACA,IAAL,EAAW;AACT,gBAAOD,IAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,SAAS,gDAAX,EAArB,CAAP;AACD;;AAED,WAAMC,WAAW,IAAIC,IAAJ,EAAjB;;AAEA,WAAMC,eAAe,SAAfA,YAAe;AAAA,gBAAW,kBAAU;AACxCb,cAAGc,MAAH,CAAUC,KAAV,CAAgB;AACdC,mBAAML,QADQ;AAEdM,oBAAO,IAAIL,IAAJ,EAFO;AAGdM,oBAAO,KAHO;AAIdC,qBAAQ,CAAE,OAAF,EAAW,SAAX,EAAsB,WAAtB;AAJM,YAAhB,EAKG,UAACC,GAAD,EAAMC,OAAN,EAAkB;AACnB,iBAAI,CAACC,OAAL,EAAc;AACZjB,mBAAIG,MAAJ,CAAW,GAAX;AACD;;AAEDH,iBAAII,IAAJ,CAAS;AACPc,qBAAMF,QAAQG,IADP;AAEPC,uBAAQH,UAAU3B,aAAa+B,SAAb,CAAuBD,MAAvB,CAAV,GAA2C,IAF5C;AAGPf,wBAASY,UAAU,IAAV,GAAiBG,OAAOf;AAH1B,cAAT;AAKD,YAfD;AAgBD,UAjBoB;AAAA,QAArB;;AAmBA,WAAIiB,KAAK,IAAIC,QAAJ,CAAa,IAAb,EAAmB,MAAnB,EAA2BtB,IAA3B,CAAT;AACAN,UAAG6B,EAAH,CAAMC,GAAN,GACCC,IADD,CACM,gBAAQ;AACZ,4BAAQC,MAAR,CAAeL,EAAf,EAAmBM,IAAnB,CAAwB,IAAxB,EAA8BjC,EAA9B,EAAkCkC,IAAlC,EACCH,IADD,CACMlB,aAAa,IAAb,CADN,EAECsB,KAFD,CAEOtB,aAAa,KAAb,CAFP;AAGD,QALD;AAMD,MApCD;AAsCD;AA5Cc,EAAjB,C;;;;;;ACJA,sC;;;;;;ACAA,2C","file":"node.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e989107d1a45fef7b643","import Promise from 'bluebird'\n\nconst CircularJSON = require('circular-json')\n\nmodule.exports = {\n  init: function(bp) {\n\n  },\n  ready: function(bp) {\n\n    bp.getRouter('botpress-terminal')\n    .post('/run', (req, res) => {\n      const code = req.body && req.body.code\n\n      if (!code) {\n        return res.status(500).send({ message: 'You must provide the `code` to run in the body' })\n      }\n\n      const fromDate = new Date()\n\n      const handleResult = success => result => {\n        bp.logger.query({ \n          from: fromDate, \n          until: new Date(), \n          order: 'asc',\n          fields: [ 'level', 'message', 'timestamp' ]\n        }, (err, results) => {\n          if (!success) {\n            res.status(500)\n          }\n\n          res.send({\n            logs: results.file,\n            result: success ? CircularJSON.stringify(result) : null,\n            message: success ? null : result.message\n          })\n        })\n      }\n\n      var fn = new Function('bp', 'knex', code)\n      bp.db.get()\n      .then(knex => {\n        Promise.method(fn).call(null, bp, knex)\n        .then(handleResult(true))\n        .catch(handleResult(false))\n      })\n    })\n\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"circular-json\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"circular-json\"\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}