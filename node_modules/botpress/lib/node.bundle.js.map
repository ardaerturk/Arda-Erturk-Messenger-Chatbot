{"version":3,"sources":["webpack:///webpack/bootstrap e5ad98e8accf6ca8e7f7","webpack:///./index.js","webpack:///external \"babel-polyfill\"","webpack:///external \"path\"","webpack:///./src/database/helpers.js","webpack:///external \"moment\"","webpack:///./src/cli/index.js","webpack:///external \"commander\"","webpack:///./src/cli/init.js","webpack:///external \"child_process\"","webpack:///external \"prompt\"","webpack:///external \"chalk\"","webpack:///external \"lodash\"","webpack:///external \"fs\"","webpack:///./src/util.js","webpack:///external \"module\"","webpack:///./src/stats.js","webpack:///external \"os\"","webpack:///external \"crypto\"","webpack:///external \"universal-analytics\"","webpack:///external \"node-machine-id\"","webpack:///./src/cli/start.js","webpack:///./src/cli/create.js","webpack:///./src/cli/install.js","webpack:///./src/modules.js","webpack:///external \"bluebird\"","webpack:///external \"axios\"","webpack:///./src/configurator.js","webpack:///./src/cli/uninstall.js","webpack:///./src/cli/migrate.js","webpack:///./src/cli/migrations ^\\.\\/.*$","webpack:///./src/cli/migrations/0.1.js","webpack:///external \"knex\"","webpack:///./src/database/kvs.js","webpack:///./src/cli/list.js","webpack:///./src/botpress.js","webpack:///external \"source-map-support/register\"","webpack:///external \"cluster\"","webpack:///./extensions/lite/ServiceLocator.js","webpack:///./extensions/lite/services.js","webpack:///./src/bus.js","webpack:///external \"eventemitter2\"","webpack:///./src/middlewares.js","webpack:///external \"mware\"","webpack:///./src/licensing.js","webpack:///./src/listeners.js","webpack:///./extensions/lite/license/index.js","webpack:///./src/logger.js","webpack:///external \"winston\"","webpack:///./src/security/index.js","webpack:///external \"jsonwebtoken\"","webpack:///./extensions/lite/authentication/index.js","webpack:///./src/notifications.js","webpack:///external \"uuid\"","webpack:///./src/hear.js","webpack:///./src/database/index.js","webpack:///./src/database/tables.js","webpack:///./extensions/lite/database/index.js","webpack:///./src/database/users.js","webpack:///./src/about.js","webpack:///./src/conversations.js","webpack:///external \"ms\"","webpack:///./package.json","webpack:///./extensions/lite/emails/index.js","webpack:///./extensions/lite/mediator/index.js","webpack:///./src/server/index.js","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///./src/server/socket.js","webpack:///external \"socket.io\"","webpack:///external \"socketio-jwt\"","webpack:///./src/server/static.js","webpack:///external \"node-sass\"","webpack:///./src/server/api.js","webpack:///external \"body-parser\"","webpack:///./src/server/anonymous.js","webpack:///./extensions/lite/api/index.js","webpack:///./extensions/lite/api/accounts.js","webpack:///./src/server/secured.js"],"names":["global","_babelPolyfill","require","path","DatabaseHelpers","CLI","Botpress","module","exports","isLite","knex","client","config","dateParse","raw","exp","dateFormat","iso","date","toDate","toISOString","columnOrDateFormat","lite","colOrDate","sql","createTableIfNotExists","tableName","cb","schema","hasTable","then","exists","format","now","isBefore","d1","d2","isAfter","isBetween","d3","isSameDay","hourOfDay","bool","true","false","parse","value","command","description","option","action","alias","version","process","argv","args","length","help","introductionText","waitingText","nextStepText","bold","assertDoesntExist","file","existsSync","print","exit","getTemplate","template","templatePath","join","__dirname","templateContent","readFileSync","generateTemplate","filename","variables","compiled","destination","replace","writeFileSync","generate","result","mkdirSync","install","npmCmd","stdout","on","data","write","toString","stderr","code","program","dirName","undefined","chdir","track","each","currentDirectoryName","basename","resolve","properties","name","white","pattern","message","required","default","author","yes","delimiter","start","get","err","IS_DEV","env","NODE_ENV","NPM_CMD","test","platform","mapping","info","warn","yellow","arguments","error","red","success","green","level","matched","splice","console","log","black","bgWhite","resolveFromDir","fromDir","moduleId","fromFile","_resolveFilename","id","paths","_nodeModulePaths","resolveModuleRootPath","entryPath","current","dirname","lookup","resolveProjectFile","projectLocation","throwIfNotExist","packagePath","Error","getBotpressVersion","botpressPackagePath","botpressJson","JSON","isDeveloping","botfile","visitor","queued","catch","hash","createHash","update","arch","hostname","type","digest","mid","strictCidFormat","forEach","a","category","label","optOutStats","push","event","trackException","projectPath","options","eval","stack","bot","MODULE_NAME_CONVENTION_BEGINS","MODULE_NAME_REGEX","RegExp","doneText","documentation","directory","prefixModuleNameWithBotpress","moduleDirectory","modules","modulesManager","MODULES_URL","FETCH_TIMEOUT","logger","dataLocation","kvs","apply","fetchAllModules","timeout","loadModules","moduleDefinitions","botpress","loadedCount","loadedModules","loader","mod","entry","handlers","configuration","init","scanModules","botPackage","deps","dependencies","merge","devDependencies","reduce","key","root","modulePackage","homepage","settings","getRandomCommunityHero","method","modulesCachePath","listAllCommunityModules","sample","username","github","avatar","contributions","hero","contributors","login","html_url","avatar_url","mapModuleList","installed","listInstalledModules","map","stars","stargazers_count","forks","forks_count","docLink","latest","keywords","fullName","full_name","updated","updated_at","issues","open_issues_count","icon","package","menuIcon","includes","license","title","featured","popular","official","stringify","diff","props","newModules","debug","Date","resolveModuleNames","names","TypeError","prefix","substr","runSpawn","reject","installModules","cwd","uninstallModules","uninstall","prodDeps","keys","filter","dep","listInstalled","_scan","_load","validations","validation","defaultValues","amendOption","validTypes","amendOptions","mapValues","validateSet","validateSave","object","objKeys","requiredKeys","validateName","overwriteFromDefaultValues","overwriteFromEnvValues","_v","overwriteFromBotfileValues","config_name","removeUnusedKeys","final","createConfig","set","saveAll","obj","loadAll","all","fromVersion","files","sortBy","x","toApply","f","parseFloat","mapSeries","migration","finally","botfilePath","bot_path","dbLocation","dataDir","migrate_database_schema","migrate_botfile","updateUsers","connection","useNullAsDefault","table","string","created_on","rows","bootstrap","DELETE_TABLES","dropTableIfExists","has","dropTable","before","indexOf","after","getSetCallback","betweenGetAndSetCallback","where","limit","row","at","setValue","original","newObj","Object","assign","modified_on","insert","primary","text","timestamp","RESTART_EXIT_CODE","getDataLocation","isAbsolute","mkdirIfNeeded","stats","interval","inverval","setInterval","isFirstRun","modulesConfigDir","db","sqlite","location","postgres","security","securityConfig","events","notifications","notification","about","licensing","middlewares","hear","hearMiddleware","middleware","emails","emailConfig","mediator","convo","register","bp","_loadedModules","server","emit","values","ready","port","projectEntry","call","reason","p","isMaster","fork","worker","isWorker","_start","setTimeout","initPromise","isFulfilled","resolveInit","_services","throwIfNotFound","getService","registerService","fn","EventBus","wildcard","maxListeners","createMiddleware","middlewareName","_use","_error","use","dispatch","isPlainObject","conformity","conformsTo","run","_promise","middlewaresFilePath","incoming","outgoing","customizations","noopChain","readCustomizations","writeCustomizations","setCustomizations","order","enabled","resetCustomizations","handler","some","m","list","orderBy","customization","load","licenseMiddleware","sendToMiddleware","mw","sendIncoming","sendOutgoing","getCustomizations","licensesPath","getLicenses","packageJsonPath","agplContent","botpressContent","agpl","licensedUnder","toLowerCase","changeLicense","licensePath","licenseFileName","licenseContent","pkg","next","response","userId","user","sendText","to","responseTo","guard","getLicensing","licenses","currentLicense","find","getStatus","getFeatures","matches","conditions","pairs","toPairs","every","comparrer","eventValue","isFunction","isRegExp","isEqual","callback","licensed","status","logConfig","Logger","transports","Console","prettyPrint","colorize","enableFileTransport","logFile","add","File","maxsize","maxSize","archiveToFile","disableFileLogs","authentication","tokenExpiry","password","ip","attempt","canAttempt","authenticate","loginUser","getSecret","secret","token","sign","expiresIn","decoded","verify","verifyUser","verified","_authentication","secretPath","createNewSecret","randomBytes","adminPassword","BOTPRESS_ADMIN_PASSWORD","attempts","lastCleanTimestamp","maxAttempts","resetAfter","email","first_name","last_name","roles","resetSecret","createJsonStore","filePath","initData","save","bindEvents","loadNotifs","saveNotifs","markReadIf","cond","notif","read","notifConfig","notificationsFile","sendNotif","url","callingFile","getOriginatingModule","callingModuleRoot","menuText","v4","maxLength","pop","unshift","logMessage","send","origPrepareStackTrace","prepareStackTrace","_","shift","getFileName","chain","condition","initializeCoreDatabase","createKnex","_knex","host","database","ssl","pool","afterCreate","conn","getDb","saveUser","gender","timezone","locale","picture_url","userRow","query","select","from","kvs_instance","createKvs","_kvs","getKvs","kvsGet","instance","kvsSet","concat","table_factories","enu","integer","getBotInformation","packageJson","INTERVAL_MSGS","formatMessage","msg","initialEvent","validateHandlers","Thread","queue","archive","waiting","_last","enqueue","match","exec","defaultHandler","i","Conversation","messageTypes","clockSpeed","_threads","currentThread","defaultThread","createThread","_get","_set","_cache","intervalBetweenMessages","_timeoutHandle","_timeoutInterval","_useTimeout","_clock","tick","_clockSpeed","_processing","_outgoing","endWhenDone","sendNext","delay","setImmediate","clearInterval","clearTimeout","thread","getCurrentThread","peek","restart","emitAsync","dequeue","say","stop","resetTimeout","repeat","teardown","convos","belongsToConvo","initial","c","processIncoming","validateEvent","create","activate","destroy","app","api","serveApi","socket","serveSocket","staticStuff","serveStatic","createServer","Promise","listen","io","handshake","authorize","onAny","serveModule","req","res","appName","contentType","serveCustomTheme","static","headers","accept","sendFile","bundlePath","webBundle","requestPath","iconRequestPath","iconPath","content","whitelabel","customTheme","themeLocation","compile","renderSync","css","routersConditions","routers","maybeSendRequireLogin","authorization","end","_authenticationMiddleware","installRouter","installProtector","installMaybeUse","maybeUse","json","urlencoded","extended","maybeApply","getRouter","router","Router","secure","operation","ressource","wrap","authorizeApi","authorized","sendStatus","post","put","delete","originalUrl","body","apis","anonymous","installAnonymous","secured","installSecured","logsSecret","noInterface","getContributor","params","unlink","until","fields","results","archivePath","download"],"mappings":"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AAjB,EAAuByL,gBAAvB,EAAP;AACD,EA7ED,C;;;;;;AC7UA,gC;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAmB,eAAe;AAClC,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;;;AC5IAnpB,QAAOC,OAAP,GAAiB,YAAM,CAAE,CAAzB,C;;;;;;;;ACAAD,QAAOC,OAAP,GAAiB;AAAA,UAAO;AACtB4E,cAAS,mBAAM,CAAE,CADK;AAEtBuM,gBAAW,qBAAM,CAAE;AAFG,IAAP;AAAA,EAAjB,C;;;;;;;;ACAA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;;;;;;;AAEApR,QAAOC,OAAP,GAAiB,cAAM;AAAA;AAAA,0DAErB,iBAAwBmpB,GAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AACQC,kBADR,GACc,mBAAIlR,EAAJ,CADd;AAAA,gDAESkR,IAAIxkB,OAAJ,CAAYukB,GAAZ,CAFT;;AAAA;AA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","file":"node.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/Users/slvn/Desktop/botpress\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e5ad98e8accf6ca8e7f7","if (!global._babelPolyfill) {\n  require('babel-polyfill')\n}\n\nvar path = require('path')\n\nvar DatabaseHelpers = require('./src/database/helpers.js')\n\nvar CLI = () => require('./src/cli')\nvar Botpress = () => require('./src/botpress.js')\n\nmodule.exports = { Botpress, DatabaseHelpers, CLI }\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 3\n// module chunks = 0","/*\n  The goal of these helpers is to generate SQL queries\n  that are valid for both SQLite and Postgres\n*/\n\nimport moment from 'moment'\n\nconst isLite = knex => {\n  return knex.client.config.client === 'sqlite3'\n}\n\nmodule.exports = knex => {\n\n  const dateParse = exp => {\n    return isLite(knex)\n    ? knex.raw(`strftime('%Y-%m-%dT%H:%M:%fZ', ${exp})`)\n    : knex.raw(exp)\n  }\n\n  const dateFormat = date => {\n    const iso = moment(date).toDate().toISOString()\n    return dateParse(`'${iso}'`)\n  }\n\n  const columnOrDateFormat = colOrDate => {\n    const lite = isLite(knex)\n\n    if (colOrDate.sql) {\n      return colOrDate.sql\n    }\n\n    if (typeof colOrDate === 'string') {\n      return lite ? dateParse(colOrDate) : `\"${colOrDate}\"`\n    }\n\n    return dateFormat(colOrDate)\n  }\n\n  return {\n    isLite: () => isLite(knex),\n\n    // knex's createTableIfNotExists doesn't work with postgres\n    // https://github.com/tgriesser/knex/issues/1303\n    createTableIfNotExists: (tableName, cb) => {\n      return knex.schema.hasTable(tableName)\n      .then(exists => {\n        if (exists) { return }\n        return knex.schema.createTableIfNotExists(tableName, cb)\n      })\n    },\n\n    date: {\n      format: dateFormat,\n\n      now: () => isLite(knex) ? knex.raw(\"strftime('%Y-%m-%dT%H:%M:%fZ', 'now')\") : knex.raw('now()'),\n\n      isBefore: (d1, d2) => {\n        d1 = columnOrDateFormat(d1)\n        d2 = columnOrDateFormat(d2)\n\n        return knex.raw(d1 + ' < ' + d2)\n      },\n\n      isAfter: (d1, d2) => {\n        d1 = columnOrDateFormat(d1)\n        d2 = columnOrDateFormat(d2)\n\n        return knex.raw(d1 + ' > ' + d2)\n      },\n\n      isBetween: (d1, d2, d3) => {\n        d1 = columnOrDateFormat(d1)\n        d2 = columnOrDateFormat(d2)\n        d3 = columnOrDateFormat(d3)\n\n        return knex.raw(`${d1} BETWEEN ${d2} AND ${d3}`)\n      },\n\n      isSameDay: (d1, d2) => {\n        d1 = columnOrDateFormat(d1)\n        d2 = columnOrDateFormat(d2)\n\n        return knex.raw(`date(${d1}) = date(${d2})`)\n      },\n\n      hourOfDay: date => {\n        date = columnOrDateFormat(date)\n        return isLite(knex)\n          ? knex.raw(`strftime('%H', ${date})`)\n          : knex.raw(`to_char(${date}, 'HH24')`)\n      }\n    },\n\n    bool: {\n\n      true: () => isLite(knex) ? 1 : true,\n      false: () => isLite(knex) ? 0 : false,\n      parse: value => isLite(knex) ? !!value : value\n\n    }\n\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/helpers.js","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 5\n// module chunks = 0","import program from 'commander'\n\nimport init from './init'\nimport start from './start'\nimport create from './create'\nimport install from './install'\nimport uninstall from './uninstall'\nimport migrate from './migrate'\nimport list from './list'\n\nimport { getBotpressVersion } from '../util'\n\nprogram\n  .command('init')\n  .description('Create a new bot in current directory')\n  .option('-y, --yes', 'Say yes to every prompt and use default values')\n  .action(init)\n\nprogram\n  .command('start [path]')\n  .alias('s')\n  .description('Starts running a bot')\n  .action(start)\n\nprogram\n  .command('install <module> [modules...]')\n  .alias('i')\n  .description('Add modules to the current bot')\n  .action(install)\n\nprogram\n  .command('uninstall <module> [modules...]')\n  .alias('u')\n  .description('Remove modules from the current bot')\n  .action(uninstall)\n\nprogram\n  .command('list')\n  .alias('ls')\n  .description('List installed modules')\n  .action(list)\n\nprogram\n  .command('create')\n  .alias('c')\n  .description('Create a new module for development or distribution')\n  .action(create)\n\nprogram\n  .command('migrate <fromVersion>')\n  .description('Migrates the current bot from version X')\n  .action(migrate)\n\nprogram\n  .version(getBotpressVersion())\n  .description('Easily create, manage and extend chatbots.')\n  .parse(process.argv)\n\nif (!program.args.length) {\n  program.help()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/index.js","module.exports = require(\"commander\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"commander\"\n// module id = 7\n// module chunks = 0","import { spawn } from 'child_process'\nimport prompt from 'prompt'\nimport chalk from 'chalk'\nimport path from 'path'\nimport _ from 'lodash'\nimport fs from 'fs'\nimport util from '../util'\nimport stats from '../stats'\n\nconst introductionText = \"\\nHey there, thanks for using botpress!\" +\n  \"\\nWe'll walk you through the creation of your new bot.\" +\n  \"\\nFor more information or help, please visit http://github.com/botpress/botpress\" + \"\\n---------------\"\n\nconst waitingText = 'please wait, we are installing everything for you...'\nconst nextStepText = 'now run ' + chalk.bold('`bp start`') + ' in your terminal'\n\nconst assertDoesntExist = (file) => {\n  if (fs.existsSync(file)) {\n    util.print('error', 'package.json or botfile.js are already in repository, ' +\n      'remove them before running this command again.')\n    process.exit(1)\n  }\n}\n\nconst getTemplate = (template) => {\n  const templatePath = path.join(__dirname, 'cli/templates/init', template)\n  const templateContent = fs.readFileSync(templatePath)\n  return _.template(templateContent)\n}\n\nconst generateTemplate = (filename, variables = {}) => {\n  const template = getTemplate(filename)\n  const compiled = template(variables)\n  const destination = path.join(filename.replace(/_\\._/, '.'))\n  fs.writeFileSync(destination, compiled)\n}\n\nconst generate = (result) => {\n  generateTemplate('package.json', result)\n  generateTemplate('LICENSE')\n  generateTemplate('botfile.js')\n  generateTemplate('index.js')\n  generateTemplate('_._gitignore')\n  generateTemplate('_._welcome')\n  generateTemplate('theme.scss')\n\n  fs.mkdirSync('data')\n  fs.writeFileSync('data/bot.log', '')\n  fs.writeFileSync('data/notification.json', '[]')\n\n  fs.mkdirSync('modules_config')\n\n  util.print(waitingText)\n  const install = spawn(util.npmCmd, ['install'])\n\n  install.stdout.on('data', (data) => {\n    process.stdout.write(data.toString())\n  })\n\n  install.stderr.on('data', (data) => {\n    process.stdout.write(data.toString())\n  })\n\n  install.on('close', (code) => {\n    if (code > 0) {\n      util.print('error', 'an error occured during installation')\n    } else {\n      util.print('success', 'installation has completed successfully')\n      util.print(nextStepText)\n    }\n  })\n}\n\nmodule.exports = function(program) {\n  var dirName = process.argv[3];\n  if (dirName != undefined) {\n    if (!fs.existsSync(dirName)) {\n      fs.mkdirSync(dirName);\n      process.chdir(dirName);\n    } else {\n      util.print('error', dirName + \" directory already exists\");\n      return;\n    }\n  }\n  stats({}).track('cli', 'bot', 'init')\n\n  util.print(introductionText)\n\n  _.each(['package.json', 'botfile.js', 'index.js'], assertDoesntExist)\n\n  const currentDirectoryName = path.basename(path.resolve('./'))\n\n  var schema = {\n    properties: {\n      name: {\n        description: chalk.white('name:'),\n        pattern: /^[a-z0-9][a-z0-9-_\\.]+$/,\n        message: 'name must be only lowercase letters, ' +\n          'digits, dashes, underscores and dots.',\n        required: true,\n        default: currentDirectoryName\n      },\n      description: {\n        required: false,\n        description: chalk.white('description:')\n      },\n      author: {\n        required: false,\n        description: chalk.white('author:')\n      },\n      version: {\n        required: false,\n        description: chalk.white('version:'),\n        default: '0.0.1'\n      },\n    }\n  }\n\n  if (program.yes) {\n    generate({\n      name: currentDirectoryName,\n      description: '',\n      author: '',\n      version: '0.0.1'\n    })\n  } else {\n    prompt.message = ''\n    prompt.delimiter = ''\n    prompt.start()\n    prompt.get(schema, function(err, result) {\n      generate(result)\n    })\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/cli/init.js","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"prompt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"prompt\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 13\n// module chunks = 0","import chalk from 'chalk'\nimport path from 'path'\nimport Module from 'module'\nimport fs from 'fs'\n\nconst IS_DEV = process.env.NODE_ENV !== 'production'\n\nconst NPM_CMD = /^win/.test(process.platform) ? 'npm.cmd' : 'npm'\n\nconst print = function(...args) {\n  const mapping = {\n    info: chalk.white,\n    warn: function() { return chalk.yellow('WARN', ...arguments) },\n    error: function() { return chalk.red('ERR', ...arguments) },\n    success: function() { return chalk.green('OK', ...arguments) }\n  }\n\n  let level = mapping[args[0]]\n  const matched = !!level\n\n  if (!matched) {\n    level = mapping.info\n  } else {\n    args.splice(0, 1)\n  }\n\n  console.log(chalk.black.bgWhite('[botpress]'), '\\t', level(...args))\n}\n\nconst resolveFromDir = function (fromDir, moduleId) {\n  fromDir = path.resolve(fromDir)\n  const fromFile = path.join(fromDir, 'noop.js')\n  try {\n    return Module._resolveFilename(moduleId, {\n      id: fromFile,\n      filename: fromFile,\n      paths: Module._nodeModulePaths(fromDir)\n    })\n  } catch (err) {\n    return null\n  }\n}\n\nconst resolveModuleRootPath = function(entryPath) {\n  let current = path.dirname(entryPath)\n  while (current !== '/') {\n    const lookup = path.join(current, 'package.json')\n    if (fs.existsSync(lookup)) {\n      return current\n    }\n    current = path.resolve(path.join(current, '..'))\n  }\n  return null\n}\n\nconst resolveProjectFile = (file, projectLocation, throwIfNotExist) => {\n  const packagePath = path.resolve(projectLocation || './', file)\n\n  if (!fs.existsSync(packagePath)) {\n    if (throwIfNotExist) {\n      throw new Error('Could not find bot\\'s package.json file')\n    }\n    return null\n  }\n\n  return packagePath\n}\n\nconst getBotpressVersion = () => {\n  const botpressPackagePath = path.join(__dirname, '../package.json')\n  const botpressJson = JSON.parse(fs.readFileSync(botpressPackagePath))\n  return botpressJson.version\n}\n\nmodule.exports = {\n  print,\n  resolveFromDir,\n  isDeveloping: IS_DEV,\n  resolveModuleRootPath,\n  resolveProjectFile,\n  npmCmd: NPM_CMD,\n  getBotpressVersion\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util.js","module.exports = require(\"module\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"module\"\n// module id = 15\n// module chunks = 0","import os from 'os'\nimport crypto from 'crypto'\nimport ua from 'universal-analytics'\nimport { machineId } from 'node-machine-id'\n\nmodule.exports = (botfile) => {\n\n  let visitor = null\n  let queued = []\n\n  machineId()\n  .catch(() => {\n    const hash = crypto.createHash('sha256')\n    hash.update(os.arch() + os.hostname() + os.platform() + os.type())\n    return hash.digest('hex')\n  })\n  .then(mid => {\n    visitor = ua('UA-90044826-1', mid, { strictCidFormat: false })\n    queued.forEach(a => a())\n    queued = []\n  })\n\n  const track = (category, action, label = null, value = null) => {\n    if (!!botfile.optOutStats) {\n      return // Don't track if bot explicitly opted out from stats collection\n    }\n\n    if (!visitor) {\n      queued.push(() => track(category, action, label, value))\n      return\n    }\n\n    visitor.event(category, action, label, value, () => { /* ignore errors */ })\n  }\n\n  const trackException = message => {\n    if (!!botfile.optOutStats) {\n      return // Don't track if bot explicitly opted out from stats collection\n    }\n\n    if (!visitor) {\n      queued.push(() => trackException(message))\n      return\n    }\n\n    visitor.event(message, () => { /* ignore errors */ })\n  }\n\n  return { track, trackException }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/stats.js","module.exports = require(\"os\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"os\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"universal-analytics\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"universal-analytics\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"node-machine-id\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-machine-id\"\n// module id = 20\n// module chunks = 0","import path from 'path'\nimport fs from 'fs'\nimport util from '../util'\nimport chalk from 'chalk'\n\n/**\n * Entry point of botpress\n *\n * It will do the following things:\n *\n * 1. Find botpress instance creator in `node_modules` folder in current project.\n * 2. Find the `botfile.js` which will be injected into the creator to create the instance.\n * 3. Start the botpress instance.\n */\nmodule.exports = function(projectPath, options) {\n  let Botpress = null\n\n  if (!projectPath || typeof(projectPath) !== 'string') {\n    projectPath = '.'\n  }\n\n  projectPath = path.resolve(projectPath)\n\n  try {\n    Botpress = eval('require')(path.join(projectPath, 'node_modules', 'botpress')).Botpress()\n  } catch (err) {\n    util.print('error', err.message)\n    util.print('error', err.stack)\n    util.print('error', '(fatal) Could not load the local version of botpress')\n    util.print('Hint: 1) have you used `botpress init` to create a new bot the proper way?')\n    util.print('Hint: 2) Do you have read and write permissions on the current directory?')\n    util.print('-------------')\n    util.print('If none of the above works, this might be a bug in botpress. ' +\n      'Please contact the Botpress Team on gitter and provide the printed error above.')\n    process.exit(1)\n  }\n\n  const botfile = path.join(projectPath, 'botfile.js')\n  if (!fs.existsSync(botfile)) {\n    util.print('error', `(fatal) No ${chalk.bold('botfile.js')} file found at: ` + botfile)\n    process.exit(1)\n  }\n\n  const bot = new Botpress({ botfile })\n  bot.start()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/start.js","import { spawn } from 'child_process'\nimport prompt from 'prompt'\nimport chalk from 'chalk'\nimport path from 'path'\nimport fs from 'fs'\nimport _ from 'lodash'\nimport util from '../util'\nimport stats from '../stats'\n\nconst MODULE_NAME_CONVENTION_BEGINS = 'botpress-'\nconst MODULE_NAME_REGEX = new RegExp(/^botpress-.*/g)\n\nconst introductionText = \"This program will bootstrap a new Botpress module\"\nconst doneText = \"You're all set! The module is boostrapped and ready to be developed.\"\nconst documentation = \"Tip: when coding your bot, use the command `npm run watch` to recompile\" +\n  \" your module automatically. Also, we strongly recommend that you install your module using \" +\n  \"`npm link ../path/to/botpress-module` so that your bot always points to the most recent version.\"\n\nconst getTemplate = (template) => {\n  const templatePath = path.join(__dirname, 'cli/templates/create' , template)\n  const templateContent = fs.readFileSync(templatePath)\n  return _.template(templateContent)\n}\n\nconst generateTemplate = (directory, filename, variables = {}) => {\n  const template = getTemplate(filename)\n  const compiled = template(variables)\n  const destination = path.join(directory, filename.replace(/_\\._/, '.'))\n  fs.writeFileSync(destination, compiled)\n}\n\nconst prefixModuleNameWithBotpress = name => {\n\n  if (!MODULE_NAME_REGEX.test(name)) {\n    util.print('warn','the name of your module needs to begin by \"botpress-\"')\n    util.print('warn','we renamed your module to '+ chalk.bold(MODULE_NAME_CONVENTION_BEGINS + name))\n    name = MODULE_NAME_CONVENTION_BEGINS + name\n  }\n\n  return name\n}\n\n\nmodule.exports = function() {\n  const moduleDirectory = path.resolve('.')\n  const dirname = path.basename(moduleDirectory)\n\n  stats({}).track('cli', 'modules', 'create')\n\n  util.print(introductionText)\n\n  var schema = {\n    properties: {\n      name: {\n        description: chalk.white('module name:'),\n        pattern: /^[a-z0-9][a-z0-9-_\\.]+$/,\n        message: 'name must be only lowercase letters, ' +\n          'digits, dashes, underscores and dots.',\n        required: true,\n        default: dirname\n      },\n      description: {\n        required: false,\n        description: chalk.white('description:')\n      },\n      author: {\n        required: false,\n        description: chalk.white('author:')\n      },\n      version: {\n        required: false,\n        description: chalk.white('version:'),\n        default: '1.0.0'\n      }\n    }\n  }\n\n  prompt.message = ''\n  prompt.delimiter = ''\n\n  prompt.start()\n\n  prompt.get(schema, function (err, result) {\n    result.name = prefixModuleNameWithBotpress(result.name)\n    \n    \n    if (dirname !== result.name) {\n      util.print('warn', 'We usually recommend that the name of the module directory'\n        + ` (${dirname}) be the same as the module name (${result.name})`)\n    }\n\n    if (fs.existsSync(path.join(moduleDirectory, 'package.json'))) {\n      util.print('error', \"Expected module directory to be empty / uninitialized\")\n      process.exit(1)\n    } else {\n      generateTemplate(moduleDirectory, 'package.json', result)\n      generateTemplate(moduleDirectory, 'LICENSE')\n      generateTemplate(moduleDirectory, 'webpack.js')\n      generateTemplate(moduleDirectory, '_._gitignore')\n      generateTemplate(moduleDirectory, '_._npmignore')\n\n      fs.mkdirSync(moduleDirectory + '/src')\n      generateTemplate(moduleDirectory, 'src/index.js')\n\n      fs.mkdirSync(moduleDirectory + '/src/views')\n      generateTemplate(moduleDirectory, 'src/views/index.jsx')\n      generateTemplate(moduleDirectory, 'src/views/style.scss')\n\n      util.print('Installing dependencies, please wait...')\n\n      const install = spawn(util.npmCmd, ['install'])\n\n      install.stdout.on('data', (data) => {\n        process.stdout.write(data.toString())\n      })\n\n      install.stderr.on('data', (data) => {\n        process.stdout.write(data.toString())\n      })\n\n      install.on('close', (code) => {\n        if (code > 0) {\n          util.print('error', 'An error occured during the dependencies installation of your module')\n        } else {\n          util.print('success', 'Module dependencies installed')\n          util.print(doneText)\n          util.print(documentation)\n        }\n      })\n    }\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/create.js","import util from '../util'\n\nimport createModules from '../modules'\n\nimport stats from '../stats'\n\nconst waitingText = 'please wait, we are trying to install your new modules...'\n\nmodule.exports = function(module, modules) {\n  stats({}).track('cli', 'modules', 'install')\n  util.print('info', waitingText)\n  let modulesManager = createModules(null, './', null)\n  modulesManager.install(module, ...modules)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/install.js","import { spawn } from 'child_process'\nimport path from 'path'\nimport fs from 'fs'\nimport Promise from 'bluebird'\nimport _ from 'lodash'\nimport moment from 'moment'\nimport axios from 'axios'\nimport { createConfig } from './configurator'\n\nimport {\n  print,\n  isDeveloping,\n  npmCmd,\n  resolveModuleRootPath,\n  resolveFromDir,\n  resolveProjectFile\n} from './util'\n\nconst MODULES_URL = 'https://s3.amazonaws.com/botpress-io/all-modules.json'\nconst FETCH_TIMEOUT = 5000\n\nmodule.exports = (logger, projectLocation, dataLocation, kvs) => {\n\n  const log = (level, ...args) => {\n    if (logger && logger[level]) {\n      logger[level].apply(this, args)\n    } else {\n      print.apply(this, [level, ...args])\n    }\n  }\n\n  const fetchAllModules = () => {\n    return axios.get(MODULES_URL, { timeout: FETCH_TIMEOUT })\n    .then(({ data }) => data)\n    .catch(() => logger.error('Could not fetch modules'))\n  }\n\n  const loadModules = (moduleDefinitions, botpress) => {\n    let loadedCount = 0\n    const loadedModules = {}\n\n    moduleDefinitions.forEach(mod => {\n      const loader = eval('require')(mod.entry)\n\n      if (typeof loader !== 'object') {\n        return logger.warn(`Ignoring module ${mod.name}. Invalid entry point signature.`)\n      }\n\n      mod.handlers = loader\n\n      try {\n        mod.configuration = createConfig({\n          kvs: kvs,\n          name: mod.name,\n          botfile: botpress.botfile,\n          options: loader.config || {}\n        })\n      } catch (err) {\n        logger.error(`Invalid module configuration in module ${mod.name}:`, err)\n      }\n\n      try {\n        loader.init && loader.init(botpress, mod.configuration)\n      } catch (err) {\n        logger.warn('Error during module initialization: ', err)\n      }\n\n      loadedModules[mod.name] = mod\n      logger.info(`Loaded ${mod.name}, version ${mod.version}`)\n      loadedCount++\n    })\n\n    if (loadedCount > 0) {\n      logger.info(`Loaded ${loadedCount} modules`)\n    }\n\n    return loadedModules\n  }\n\n  const scanModules = () => {\n    const packagePath = path.join(projectLocation, 'package.json')\n\n    if (!fs.existsSync(packagePath)) {\n      return logger.warn('No package.json found at project root, ' +\n        'which means botpress can\\'t load any module for the bot.')\n    }\n\n    const botPackage = eval('require')(packagePath)\n\n    let deps = botPackage.dependencies || {}\n    if (isDeveloping) {\n      deps = _.merge(deps, botPackage.devDependencies || {})\n    }\n\n    return _.reduce(deps, (result, value, key) => {\n      if (!/^botpress-/i.test(key)) {\n        return result\n      }\n      const entry = resolveFromDir(projectLocation, key)\n      if (!entry) {\n        return result\n      }\n      const root = resolveModuleRootPath(entry)\n      if (!root) {\n        return result\n      }\n\n      const modulePackage = eval('require')(path.join(root, 'package.json'))\n      if (!modulePackage.botpress) {\n        return result\n      }\n\n      return result.push({\n        name: key,\n        root: root,\n        homepage: modulePackage.homepage,\n        settings: modulePackage.botpress,\n        version: modulePackage.version,\n        entry: entry\n      }) && result\n    }, [])\n  }\n\n  const getRandomCommunityHero = Promise.method(() => {\n    const modulesCachePath = path.join(dataLocation, './modules-cache.json')\n\n    return listAllCommunityModules()\n    .then(() => {\n      const { modules } = JSON.parse(fs.readFileSync(modulesCachePath))\n\n      const module = _.sample(modules)\n\n      if (!module) {\n        return {\n          username: 'danyfs',\n          github: 'https://github.com/danyfs',\n          avatar: 'https://avatars1.githubusercontent.com/u/5629987?v=3',\n          contributions: 'many',\n          module: 'botpress'\n        }\n      }\n\n      const hero = _.sample(module.contributors)\n\n      return {\n        username: hero.login,\n        github: hero.html_url,\n        avatar: hero.avatar_url,\n        contributions: hero.contributions,\n        module: module.name\n      }\n    })\n  })\n\n  const mapModuleList = (modules) => {\n    const installed = listInstalledModules()\n    return modules.map(mod => ({\n      name: mod.name,\n      stars: mod.github.stargazers_count,\n      forks: mod.github.forks_count,\n      docLink: mod.homepage,\n      version: mod['dist-tags'].latest,\n      keywords: mod.keywords,\n      fullName: mod.github.full_name,\n      updated: mod.github.updated_at,\n      issues: mod.github.open_issues_count,\n      icon: mod.package.botpress.menuIcon,\n      description: mod.description,\n      installed: _.includes(installed, mod.name),\n      license: mod.license,\n      author: !mod.author.name ? mod.author : mod.author.name,\n      title: mod.title,\n      category: mod.category,\n      featured: mod.featured,\n      popular: mod.popular,\n      official: mod.official\n    }))\n  }\n\n  const listAllCommunityModules = Promise.method(() => {\n\n    if (!fs) {\n      return [] // TODO Fetch & return\n    }\n\n    const modulesCachePath = path.join(dataLocation, './modules-cache.json')\n    if (!fs.existsSync(modulesCachePath)) {\n      fs.writeFileSync(modulesCachePath, JSON.stringify({\n        modules: [],\n        updated: null\n      }))\n    }\n\n    const { modules, updated } = JSON.parse(fs.readFileSync(modulesCachePath))\n\n    if (updated && moment().diff(moment(updated), 'minutes') <= 30) {\n      return mapModuleList(modules)\n    }\n\n    return Promise.props({\n      newModules: fetchAllModules()\n    })\n    .then(({ newModules }) => {\n\n      if (!newModules || !newModules.length) {\n        if (modules.length > 0) {\n          logger.debug('Fetched invalid modules. Report this to the Botpress Team.')\n          return mapModuleList(modules)\n        } else {\n          newModules = newModules || []\n        }\n      }\n\n      fs.writeFileSync(modulesCachePath, JSON.stringify({\n        modules: newModules,\n        updated: new Date()\n      }))\n\n      return mapModuleList(newModules)\n    })\n  })\n\n  const resolveModuleNames = (names) => {\n    return names.map(name => {\n      if (!name || typeof(name) !== 'string') {\n        throw new TypeError('Expected module name to be a string')\n      }\n\n      let basename = path.basename(name)\n      let prefix = ''\n\n      if (basename !== name) {\n        prefix = name.substr(0, name.length - basename.length - 1)\n      }\n\n      if (basename.replace(/botpress-?/i, '').length === 0) {\n        throw new Error(`Invalid module name: ${basename}`)\n      }\n\n      if (!/^botpress-/i.test(basename)) {\n        basename = `botpress-${basename}`\n      }\n\n      return prefix + basename\n    })\n  }\n\n  const runSpawn = (command) => {\n    return new Promise((resolve, reject) => {\n      command.stdout.on('data', (data) => {\n        log('info', data.toString())\n      })\n\n      command.stderr.on('data', (data) => {\n        log('error', data.toString())\n      })\n\n      command.on('close', (code) => {\n        if (code > 0) {\n          reject()\n        } else {\n          resolve()\n        }\n      })\n    })\n  }\n\n  const installModules = Promise.method((...names) => {\n    let modules = resolveModuleNames(names)\n\n    const install = spawn(npmCmd, ['install', '--save', ...modules], {\n      cwd: projectLocation\n    })\n\n    log('info', 'Installing modules: ' + modules.join(', '))\n\n    return runSpawn(install)\n    .then(() => log('success', 'Modules successfully installed'))\n    .catch(err => {\n      log('error', 'An error occured during modules installation.')\n      throw err\n    })\n  })\n\n  const uninstallModules = Promise.method((...names) => {\n    let modules = resolveModuleNames(names)\n    const uninstall = spawn(npmCmd, ['uninstall', '--save', ...modules], {\n      cwd: projectLocation\n    })\n\n    log('info', `Uninstalling modules: ${modules.join(', ')}`)\n\n    return runSpawn(uninstall)\n    .then(() => log('success', 'Modules successfully removed'))\n    .catch(err => {\n      log('error', 'An error occured during modules removal.')\n      throw err\n    })\n  })\n\n\n  const listInstalledModules = () => {\n    const packagePath = resolveProjectFile('package.json', projectLocation, true)\n    const { dependencies } = JSON.parse(fs.readFileSync(packagePath))\n    const prodDeps = _.keys(dependencies)\n\n    return _.filter(prodDeps, dep => /botpress-.+/i.test(dep))\n  }\n\n  return {\n    listAllCommunityModules,\n    getRandomCommunityHero,\n    install: installModules,\n    uninstall: uninstallModules,\n    listInstalled: listInstalledModules,\n    _scan: scanModules,\n    _load: loadModules\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 26\n// module chunks = 0","import _ from 'lodash'\n\nconst validations = {\n  'any': (value, validation) => validation(value),\n  'string': (value, validation) => typeof(value) === 'string' && validation(value),\n  'choice': (value, validation) => _.includes(validation, value),\n  'bool': (value, validation) => (value === true || value === false) && validation(value)\n}\n\nconst defaultValues = {\n  'any': null,\n  'string': '',\n  'bool': false\n}\n\nconst amendOption = (option, name) => {\n\n  const validTypes = _.keys(validations)\n  if (!option.type || !_.includes(validTypes, option.type)) {\n    throw new Error(`Invalid type (${option.type || ''}) for config key (${name})`)\n  }\n\n  const validation = option.validation || (() => true)\n\n  if (typeof(option.default) !== 'undefined' && !validations[option.type](option.default, validation)) {\n    throw new Error(`Invalid default value (${option.default}) for (${name})`)\n  }\n\n  if (!option.default && !_.includes(_.keys(defaultValues), option.type)) {\n    throw new Error(`Default value is mandatory for type ${option.type} (${name})`)\n  }\n\n  return {\n    type: option.type,\n    required: option.required || false,\n    env: option.env || null,\n    default: option.default || defaultValues[option.type],\n    validation: validation\n  }\n}\n\nconst amendOptions = options => {\n  return _.mapValues(options, amendOption)\n}\n\nconst validateSet = (options, name, value) => {\n\n  // if name is not in options, throw\n  if (!_.includes(_.keys(options), name)) {\n    throw new Error(`Unrecognized configuration key: ${name}`)\n  }\n\n  if (!validations[options[name].type](value, options[name].validation)) {\n    throw new Error(`Invalid value for key: ${name}`)\n  }\n}\n\nconst validateSave = (options, object) => {\n  const objKeys = _.keys(object)\n  const requiredKeys = _.filter(_.keys(options), key => options[key].required)\n\n  _.each(requiredKeys, required => {\n    if (!_.includes(objKeys, required)) {\n      throw new Error(`Missing required configuration: '${required}'`)\n    }\n  })\n\n  _.each(objKeys, name => {\n    validateSet(options, name, object[name])\n  })\n}\n\nconst validateName = name => {\n  if (!name || !/^[A-Z0-9._-]+$/i.test(name)) {\n    throw new Error(`Invalid configuration name: ${name}. The name must only contain letters, _ and -`)\n  }\n}\n\nconst overwriteFromDefaultValues = (options, object) => {\n  _.each(_.keys(options), name => {\n    if (typeof object[name] === 'undefined') {\n      object[name] = options[name].default\n    }\n  })\n\n  return object\n}\n\nconst overwriteFromEnvValues = (options, object) => {\n  return _.mapValues(object, (_v, name) => {\n    if (options[name] && options[name].env && process.env[options[name].env]) {\n      return process.env[options[name].env]\n    }\n\n    return _v\n  })\n}\n\nconst overwriteFromBotfileValues = (config_name, options, botfile, object) => {\n  return _.mapValues(object, (_v, name) => {\n    if (botfile \n      && botfile.config \n      && botfile.config[config_name] \n      && typeof botfile.config[config_name][name] !== 'undefined') {\n      return botfile.config[config_name][name]\n    }\n\n    return _v\n  })\n}\n\nconst removeUnusedKeys = (options, object) => {\n  const final = {}\n\n  _.each(_.keys(options), name => {\n    if (typeof object[name] !== 'undefined') {\n      final[name] = object[name]\n    }\n  })\n\n  return final\n}\n\nconst createConfig = ({ kvs, name, botfile = {}, options = {} }) => {\n\n  if (!kvs || !kvs.get || !kvs.set) {\n    throw new Error('A valid \\'kvs\\' is mandatory to createConfig')\n  }\n\n  validateName(name)\n  options = amendOptions(options)\n\n  const saveAll = obj => {\n    validateSave(options, obj)\n    return kvs.set('__config', obj, name)\n  }\n\n  const loadAll = () => {\n    return kvs.get('__config', name)\n    .then(all => overwriteFromDefaultValues(options, all || {}))\n    .then(all => overwriteFromBotfileValues(name, options, botfile, all))\n    .then(all => overwriteFromEnvValues(options, all))\n    .then(all => removeUnusedKeys(options, all))\n  }\n\n  const get = name => {\n    return kvs.get('__config', name + '.' + name)\n    .then(value => overwriteFromDefaultValues(options, { [name]: value }))\n    .then(all => overwriteFromBotfileValues(name, options, botfile, all))\n    .then(all => overwriteFromEnvValues(options, all))\n    .then(obj => obj[name])\n  }\n\n  const set = (name, value) => {\n    validateSet(options, name, value)\n    return kvs.set('__config', value, name + '.' + name)\n  }\n  \n  return { saveAll, loadAll, get, set, options }\n}\n\nmodule.exports = { createConfig }\n\n\n\n// WEBPACK FOOTER //\n// ./src/configurator.js","import util from '../util'\n\nimport createModules from '../modules'\n\nimport stats from '../stats'\n\nconst waitingText = 'please wait, we are trying to uninstall the modules...'\n\nmodule.exports = function(module, modules) {\n  stats({}).track('cli', 'modules', 'install')\n  util.print('info', waitingText)\n  let modulesManager = createModules(null, './', null)\n  modulesManager.uninstall(module, ...modules)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/uninstall.js","import util from '../util'\nimport stats from '../stats'\nimport fs from 'fs'\nimport path from 'path'\nimport _ from 'lodash'\nimport Promise from 'bluebird'\n\nmodule.exports = function(fromVersion) {\n  stats({}).track('cli', 'migration', fromVersion)\n\n  if (!fs.existsSync('./botfile.js')) {\n    throw new Error('You must be inside a bot directory to run a migration')\n  }\n\n  let files = _.sortBy(require.context('./migrations/').keys(), x => x)\n\n  const toApply = _.filter(files, f => {\n    if (!/.js$/i.test(f)) {\n      return false\n    }\n\n    return parseFloat(fromVersion) < parseFloat(f.replace(/\\.js/i, ''))\n  })\n\n  return Promise.mapSeries(toApply, file => {\n    const migration = require('./migrations/' + file)\n    return migration(path.resolve('.'))\n    .then(() => {\n      util.print('success', `Migration ${file.replace('.js', '')} applied successfully`)\n    })\n  })\n  .finally(() => {\n    util.print('success', 'Migration completed.')\n    process.exit(0)\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/migrate.js","var map = {\n\t\"./0.1\": 31,\n\t\"./0.1.js\": 31\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 30;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/cli/migrations ^\\.\\/.*$\n// module id = 30\n// module chunks = 0","import Knex from 'knex'\nimport path from 'path'\nimport fs from 'fs'\n\nimport kvs from '../../database/kvs'\nimport util from '../../util'\n\nmodule.exports = bot_path => {\n  const botfilePath = path.join(bot_path, 'botfile.js')\n  const botfile = eval('require')(botfilePath)\n  const dbLocation = path.resolve(path.join(bot_path, botfile.dataDir, 'db.sqlite'))\n\n  return migrate_database_schema(dbLocation)\n  .then(() => migrate_botfile(botfilePath))\n}\n\n\nfunction migrate_database_schema(dbLocation) {\n\n  const updateUsers = `strftime('%Y-%m-%dT%H:%M:%fZ', created_on/1000, 'unixepoch')`\n\n  const knex = Knex({\n    client: 'sqlite3',\n    connection: { filename: dbLocation },\n    useNullAsDefault: true\n  })\n\n  return knex.schema.table('users', function (table) {\n    table.string('picture_url')\n    table.string('first_name')\n    table.string('last_name')\n  })\n  .then(() => knex('users').update({ created_on: knex.raw(updateUsers) }))\n  .then(rows => {\n    util.print('info', 'Updated ' + rows + ' users')\n    util.print('warn', 'Users table was migrated to new schema but existing '\n      + 'users will miss the following fields: `picture_url`, `first_name`, '\n      + '`last_name`. They have been left to `null`.')\n  })\n  .catch(() => {\n    util.print('warn', 'Did not migrate table `users` as schema was already up to date')\n  })\n  .then(() => kvs(knex).bootstrap())\n  .catch(() => {\n    util.print('warn', 'Did not create table `kvs` as schema was already up to date')\n  })\n  .then(() => {\n\n    if (!process.env.DELETE_TABLES) {\n      util.print('warn', \"This migration must delete the tables of \"\n        + \"the following modules: `botpress-scheduler`, `botpress-analytics`, \"\n        + \"`botpress-hitl` and `botpress-subscription`.\")\n\n      util.print('warn', \"This step has been skipped because you didn't provide \"\n        + \"the DELETE_TABLES=true environement variable.\")\n\n      util.print('warn', \"Please backup your data if necessary then re-run with DELETE_TABLES=true\")\n      return false\n    }\n\n    return dropTableIfExists(knex, 'analytics_interactions')\n    .then(() => dropTableIfExists(knex, 'analytics_runs'))\n    .then(() => dropTableIfExists(knex, 'broadcast_outbox'))\n    .then(() => dropTableIfExists(knex, 'broadcast_schedules'))\n    .then(() => dropTableIfExists(knex, 'hitl_messages'))\n    .then(() => dropTableIfExists(knex, 'hitl_sessions'))\n    .then(() => dropTableIfExists(knex, 'subscription_users'))\n    .then(() => dropTableIfExists(knex, 'subscriptions'))\n    .then(() => dropTableIfExists(knex, 'scheduler_schedules'))\n    .then(() => dropTableIfExists(knex, 'scheduler_tasks'))\n    .then(() => util.print('info', 'Dropped module tables'))\n  })\n}\n\nfunction dropTableIfExists(knex, tableName) {\n  return knex.schema.hasTable(tableName)\n  .then(has => {\n    if (has) {\n      return knex.schema.dropTable(tableName)\n    }\n  })\n}\n\nfunction migrate_botfile(botfilePath) {\n  const before = fs.readFileSync(botfilePath).toString()\n\n  if (before.indexOf('postgres:') >= 0) {\n    util.print('warn', 'Did not migrate botfile as it seemed like `postgres`'\n      + ' was already present. Please migrate manually if this is a mistake.')\n    return false\n  }\n\n  const after = before.replace(/module\\.exports.*?=.*?{/i, `module.exports = {\n\n  /**\n  * Postgres configuration\n  */\n  postgres: {\n    enabled: process.env.DATABASE === 'postgres',\n    host: process.env.PG_HOST || '127.0.0.1',\n    port: process.env.PG_PORT || 5432,\n    user: process.env.PG_USER || '',\n    password: process.env.PG_PASSWORD || '',\n    database: process.env.PG_DB || ''\n  },`)\n\n  fs.writeFileSync(botfilePath, after)\n\n  util.print('info', 'Updated botfile')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/migrations/0.1.js","module.exports = require(\"knex\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"knex\"\n// module id = 32\n// module chunks = 0","import Promise from 'bluebird'\nimport _ from 'lodash'\n\nimport helpers from './helpers'\n\n/*\n  Possible options:\n    - betweenGetAndSetCallback: will be called between the get and the set\n    and wait for promise to resolve\n    - tableName: overrides the KVS table's name\n*/\nmodule.exports = (knex, options = {}) => {\n  const getSetCallback = options.betweenGetAndSetCallback || (() => Promise.resolve())\n  const tableName = options.tableName || 'kvs'\n\n  const get = (key, path) => {\n    return knex(tableName).where({ key }).limit(1).then().get(0).then(row => {\n      if (!row) {\n        return null\n      }\n\n      const obj = JSON.parse(row.value)\n      if (!path) {\n        return obj\n      }\n\n      return _.at(obj, [path])[0]\n    })\n  }\n\n  const set = (key, value, path) => {\n    const now = helpers(knex).date.now()\n\n    const setValue = obj => {\n      if (path) {\n        _.set(obj, path, value)\n        return obj\n      } else {\n        return value\n      }\n    }\n\n    return get(key)\n    .then(original => {\n      return getSetCallback()\n      .then(() => {\n        if (original) {\n          const newObj = setValue(Object.assign({}, original))\n          return knex(tableName).where({ key }).update({\n            value: JSON.stringify(newObj),\n            modified_on: now\n          }).then()\n        } else {\n          const obj = setValue({})\n          return knex(tableName).insert({\n            key: key,\n            value: JSON.stringify(obj),\n            modified_on: now\n          }).then()\n        }\n      })\n    })\n  }\n\n  const bootstrap = () => {\n    return helpers(knex).createTableIfNotExists(tableName, function(table) {\n      table.string('key').primary()\n      table.text('value')\n      table.timestamp('modified_on')\n    })\n  }\n\n  return { get, set, bootstrap }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/kvs.js","import { print } from '../util'\n\nimport createModules from '../modules'\n\nmodule.exports = function() {\n  let modulesManager = createModules(null, './', null)\n  let modules = modulesManager.listInstalled()\n\n  if (!modules || modules.length === 0) {\n    print('info', \"There are no module installed.\")\n    print('------------------')\n    print('info', \"To install modules, use `botpress install <module-name>`\")\n    print('info', \"You can discover modules in the Modules section of your bot UI\" +\n      \". You can also search npm with the botpress keyword.\")\n  } else {\n    print('info', \"There are \" + modules.length + \" modules installed:\")\n    modules.forEach(mod => print('>> ' + mod))\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/list.js","import 'source-map-support/register'\n\nimport chalk from 'chalk'\nimport path from 'path'\nimport fs from 'fs'\nimport _ from 'lodash'\nimport cluster from 'cluster'\n\nimport ServiceLocator from '+/ServiceLocator'\nimport EventBus from './bus'\n\nimport createMiddlewares from './middlewares'\nimport createLogger from './logger'\nimport createSecurity from './security'\nimport createNotifications from './notifications'\nimport createHearMiddleware from './hear'\nimport createDatabase from './database'\nimport createLicensing from './licensing'\nimport createAbout from './about'\nimport createModules from './modules'\nimport createConversations from './conversations'\nimport stats from './stats'\nimport packageJson from '../package.json'\nimport createEmails from '+/emails'\nimport createMediator from '+/mediator'\n\nimport createServer from './server'\n\nimport { getBotpressVersion } from './util'\n\nimport {\n  isDeveloping,\n  print\n} from './util'\n\nconst RESTART_EXIT_CODE = 107\n\nconst getDataLocation = (dataDir, projectLocation) => (\n  dataDir && path.isAbsolute(dataDir)\n    ? path.resolve(dataDir)\n    : path.resolve(projectLocation, dataDir || 'data')\n)\n\nconst mkdirIfNeeded = (path, logger) => {\n  if (!fs.existsSync(path)) {\n    logger.info(`Creating data directory: ${path}`)\n\n    try {\n      fs.mkdirSync(path)\n    } catch (err) {\n      logger.error(`[FATAL] Error creating directory: ${err.message}`)\n      process.exit(1)\n    }\n  }\n}\n\n/**\n * Global context botpress\n*/\nclass botpress {\n  /**\n   * Create botpress\n   *\n   * @param {string} obj.botfile - the config path\n   */\n  constructor({ botfile }) {\n    this.version = getBotpressVersion()\n    /**\n     * The project location, which is the folder where botfile.js located\n     */\n    this.projectLocation = path.dirname(botfile)\n\n    /**\n     * The botfile config object\n     */\n    this.botfile = eval('require')(botfile)\n\n    this.stats = stats(this.botfile)\n\n    this.interval = null\n  }\n\n  /**\n   * Start the bot instance\n   *\n   * It will do the following initiation steps:\n   *\n   * 1. setup logger\n   * 2. resolve paths (dataLocation)\n   * 3. inject security functions\n   * 4. load modules\n   */\n  _start() {\n\n    this.stats.track('bot', 'started')\n\n    if (!this.interval) {\n      this.inverval = setInterval(() => {\n        this.stats.track('bot', 'running')\n      }, 30 * 1000)\n    }\n\n    // change the current working directory to botpress's installation path\n    // the bot's location is kept in this.projectLocation\n    process.chdir(path.join(__dirname, '../'))\n\n    const { projectLocation, botfile } = this\n\n    const isFirstRun = fs.existsSync(path.join(projectLocation, '.welcome'))\n    const dataLocation = getDataLocation(botfile.dataDir, projectLocation)\n    const modulesConfigDir = getDataLocation(botfile.modulesConfigDir, projectLocation)\n    const dbLocation = path.join(dataLocation, 'db.sqlite')\n    const version = packageJson.version\n\n    const logger = createLogger(dataLocation, botfile.log)\n    mkdirIfNeeded(dataLocation, logger)\n    mkdirIfNeeded(modulesConfigDir, logger)\n\n    logger.info(`Starting botpress version ${version}`)\n\n    const db = createDatabase({\n      sqlite: { location: dbLocation },\n      postgres: botfile.postgres\n    })\n\n    const security = createSecurity({\n      dataLocation,\n      securityConfig: botfile.login,\n      db\n    })\n\n    const modules = createModules(logger, projectLocation, dataLocation, db.kvs)\n\n    const moduleDefinitions = modules._scan()\n\n    const events = new EventBus()\n    const notifications = createNotifications(dataLocation, botfile.notification, moduleDefinitions, events, logger)\n    const about = createAbout(projectLocation)\n    const licensing = createLicensing({ logger, projectLocation, version, db, botfile })\n    const middlewares = createMiddlewares(this, dataLocation, projectLocation, logger)\n    const { hear, middleware: hearMiddleware } = createHearMiddleware()\n    const emails = createEmails({ emailConfig: botfile.emails })\n    const mediator = createMediator(this)\n    const convo = createConversations({ logger, middleware: middlewares })\n\n    middlewares.register(hearMiddleware)\n\n    _.assign(this, {\n      dataLocation,\n      isFirstRun,\n      version,\n      logger,\n      security, // login, authenticate, getSecret\n      events,\n      notifications,    // load, save, send\n      about,\n      middlewares,\n      hear,\n      licensing,\n      modules,\n      db,\n      emails,\n      mediator,\n      convo\n    })\n\n    ServiceLocator.init({ bp: this })\n\n    const loadedModules = modules._load(moduleDefinitions, this)\n\n    this.stats.track('bot', 'modules', 'loaded', loadedModules.length)\n\n    _.assign(this, {\n      _loadedModules: loadedModules\n    })\n\n    mediator.install()\n\n    const server = createServer(this)\n    server.start()\n    .then(() => {\n      events.emit('ready')\n      for (let mod of _.values(loadedModules)) {\n        mod.handlers.ready && mod.handlers.ready(this, mod.configuration)\n      }\n\n      const { port } = botfile\n      logger.info(chalk.green.bold('Bot launched. Visit: http://localhost:' + port))\n    })\n\n    const projectEntry = eval('require')(projectLocation)\n    if (typeof(projectEntry) === 'function') {\n      projectEntry.call(projectEntry, this)\n    } else {\n      logger.error('[FATAL] The bot entry point must be a function that takes an instance of bp')\n      process.exit(1)\n    }\n\n    process.on('uncaughtException', err => {\n      logger.error('[FATAL] An unhandled exception occured in your bot', err)\n      if (isDeveloping) {\n        logger.error(err.stack)\n      }\n\n      this.stats.trackException(err.message)\n      process.exit(1)\n    })\n\n    process.on('unhandledRejection', (reason, p) => {\n      logger.error('Unhandled Rejection in Promise: ', p, 'Reason:', reason)\n\n      this.stats.trackException(reason)\n      if (isDeveloping && reason && reason.stack) {\n        logger.error(reason.stack)\n      }\n    })\n  }\n\n  start() {\n    if (cluster.isMaster) {\n      cluster.fork()\n\n      cluster.on('exit', (worker, code /* , signal */) => {\n        if (code === RESTART_EXIT_CODE) {\n          cluster.fork()\n\n          this.stats.track('bot', 'restarted')\n          print('info', '*** restarted worker process ***')\n        } else {\n          process.exit(code)\n        }\n      })\n    }\n\n    if (cluster.isWorker) {\n      this._start()\n    }\n  }\n\n  restart(interval = 0) {\n    setTimeout(() => {\n      process.exit(RESTART_EXIT_CODE)\n    }, interval)\n  }\n}\n\nmodule.exports = botpress\n\n\n\n// WEBPACK FOOTER //\n// ./src/botpress.js","module.exports = require(\"source-map-support/register\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"source-map-support/register\"\n// module id = 36\n// module chunks = 0","module.exports = require(\"cluster\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cluster\"\n// module id = 37\n// module chunks = 0","import Promise from 'bluebird'\nimport services from '+/services'\n\nconst _services = {}\nlet resolveInit = false\n\nlet initPromise = new Promise(resolve => {\n  resolveInit = resolve\n})\n\nasync function init(obj) {\n  if (!initPromise.isFulfilled()) {\n    resolveInit()\n    Object.assign(_services, await services(obj))\n  }\n}\n\nfunction registerService(name, fn) {\n  if (!!_services[name]) {\n    throw new Error(`Service '${name}' has already been set`)\n  }\n\n  _services[name] = fn\n}\n\nasync function getService(name, throwIfNotFound = true) {\n  await initPromise\n  .timeout(5000)\n  .catch(err => {\n    throw new Error('ServiceLocator was not initialized')\n  })\n  \n  if (throwIfNotFound && !_services[name]) {\n    throw new Error(`Service '${name}' not registered`)\n  }\n\n  return _services[name]\n}\n\nmodule.exports = { init, registerService, getService }\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/ServiceLocator.js","module.exports = async ({ bp }) => {}\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/services.js","import EventEmitter2 from 'eventemitter2'\n\nclass EventBus extends EventEmitter2 {\n  constructor() {\n    super({\n      wildcard: true,\n      maxListeners: 100\n    })\n  }\n}\n\nmodule.exports = EventBus\n\n\n\n// WEBPACK FOOTER //\n// ./src/bus.js","module.exports = require(\"eventemitter2\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"eventemitter2\"\n// module id = 41\n// module chunks = 0","import _ from 'lodash'\nimport mware from 'mware'\nimport path from 'path'\nimport fs from 'fs'\nimport Promise from 'bluebird'\n\nimport licensing from './licensing'\n\nconst createMiddleware = function(bp, middlewareName) {\n  const _use = mware()\n  const _error = mware()\n\n  const use = function(middleware) {\n    if (typeof(middleware) !== 'function') {\n      throw new TypeError('Expected all middleware arguments to be functions')\n    }\n\n    if (middleware.length === 2) {\n      _use(middleware)\n    } else if (middleware.length === 3) {\n      _error(middleware)\n    }\n  }\n\n  const dispatch = function(event) {\n    if (!_.isPlainObject(event)) {\n      throw new TypeError('Expected all dispatch arguments to be plain event objects')\n    }\n\n    const conformity = {\n      type: function(value) { return typeof(value) === 'string' },\n      platform: function(value) { return typeof(value) === 'string' },\n      text: function(value) { return typeof(value) === 'string' },\n      raw: function() { return true }\n    }\n\n    if (!_.conformsTo(event, conformity)) {\n      throw new TypeError('Expected event to contain (type: string), ' +\n        '(platform: string), (text: string), (raw: any)')\n    }\n\n    // Provide botpress to the event handlers\n    event.bp = bp\n\n    _use.run(event, function(err) {\n      if (err) {\n        _error.run(err, event, () => {\n          bp.logger.error(`[BOTPRESS] Unhandled error in middleware (${middlewareName}). Error: ${err.message}`)\n        })\n      }\n    })\n\n    return event._promise || Promise.resolve()\n  }\n\n  return { use, dispatch }\n}\n\nmodule.exports = function(bp, dataLocation, projectLocation, logger) {\n  const middlewaresFilePath = path.join(dataLocation, 'middlewares.json')\n  let incoming, outgoing, middlewares, customizations\n\n  const noopChain = function() {\n    let message = 'Middleware called before middlewares have been loaded. This is a no-op.'\n     + ' Have you forgotten to call `bp.loadMiddlewares()` in your bot?'\n\n    if (arguments && typeof(arguments[0]) === 'object') {\n      message += '\\nCalled with: ' + JSON.stringify(arguments[0], null, 2)\n    }\n\n    logger.warn(message)\n  }\n\n  const readCustomizations = () => {\n    if (!fs.existsSync(middlewaresFilePath)) {\n      fs.writeFileSync(middlewaresFilePath, '{}')\n    }\n    return JSON.parse(fs.readFileSync(middlewaresFilePath))\n  }\n\n  const writeCustomizations = () => {\n    fs.writeFileSync(middlewaresFilePath, JSON.stringify(customizations))\n  }\n\n  const setCustomizations = middlewares => {\n    _.each(middlewares, (middleware => {\n      const { name, order, enabled } = middleware\n      customizations[name] = { order, enabled }\n    }))\n    writeCustomizations()\n  }\n\n  const resetCustomizations = () => {\n    customizations = {}\n    writeCustomizations()\n  }\n\n  const register = (middleware) => {\n    if (!middleware || !middleware.name) {\n      logger.error('A unique middleware name is mandatory')\n      return false\n    }\n\n    if (!middleware.handler) {\n      logger.error('A middleware handler is mandatory')\n      return false\n    }\n\n    if (!middleware.type || (middleware.type !== 'incoming' && middleware.type !== 'outgoing')) {\n      logger.error('A middleware type (incoming or outgoing) is required')\n      return false\n    }\n\n    middleware.order = middleware.order || 0\n    middleware.enabled = typeof middleware.enabled === 'undefined' ? true: !!middleware.enabled\n\n    if (_.some(middlewares, m => m.name === middleware.name)) {\n      logger.error('Another middleware with the same name has already been registered')\n      return false\n    }\n\n    middlewares.push(middleware)\n  }\n\n  const list = () => {\n    return _.orderBy(middlewares.map(middleware => {\n      const customization = customizations[middleware.name]\n      if (customization) {\n        return Object.assign({}, middleware, customization)\n      }\n      return middleware\n    }), 'order')\n  }\n\n  const load = () => {\n    incoming = createMiddleware(bp, 'incoming')\n    outgoing = createMiddleware(bp, 'outgoing')\n\n    const { middleware: licenseMiddleware } = bp.licensing\n    incoming.use(licenseMiddleware)\n\n    _.each(list(), (m => {\n      if (!m.enabled) {\n        return logger.debug('SKIPPING middleware:', m.name, ' [Reason=disabled]')\n      }\n\n      logger.debug('Loading middleware:', m.name)\n\n      if (m.type === 'incoming') {\n        incoming.use(m.handler)\n      } else {\n        outgoing.use(m.handler)\n      }\n    }))\n  }\n\n  const sendToMiddleware = type => event => {\n    let mw = type === 'incoming' ? incoming : outgoing\n    return mw.dispatch ? mw.dispatch(event) : mw(event)\n  }\n\n  const sendIncoming = sendToMiddleware('incoming')\n  const sendOutgoing = sendToMiddleware('outgoing')\n\n  incoming = outgoing = noopChain\n  middlewares = []\n  customizations = readCustomizations()\n\n  return {\n    load,\n    list,\n    register,\n    sendIncoming,\n    sendOutgoing,\n    getCustomizations: () => customizations,\n    setCustomizations,\n    resetCustomizations\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/middlewares.js","module.exports = require(\"mware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mware\"\n// module id = 43\n// module chunks = 0","import path from 'path'\nimport fs from 'fs'\nimport Promise from 'bluebird'\n\nimport _ from 'lodash'\n\nimport listeners from './listeners'\nimport { resolveProjectFile, isDeveloping } from './util'\nimport LicenseGuard from '+/license'\n\nmodule.exports = ({ logger, version, projectLocation, db, botfile }) => {\n\n  const licensesPath = path.join(__dirname, '../licenses')\n\n  const getLicenses = () => {\n    const packageJsonPath = resolveProjectFile('package.json', projectLocation, true)\n    const { license } = JSON.parse(fs.readFileSync(packageJsonPath))\n\n    const agplContent = fs.readFileSync(path.join(licensesPath, 'LICENSE_AGPL3')).toString()\n    const botpressContent = fs.readFileSync(path.join(licensesPath, 'LICENSE_BOTPRESS')).toString()\n\n    return {\n      agpl: {\n        name: 'AGPL-3.0',\n        licensedUnder: license === 'AGPL-3.0',\n        text: agplContent\n      },\n      botpress: {\n        name: 'Botpress',\n        licensedUnder: license.toLowerCase().indexOf('botpress') >= 0,\n        text: botpressContent\n      }\n    }\n  }\n\n  const changeLicense = Promise.method((license) => {\n    const packageJsonPath = resolveProjectFile('package.json', projectLocation, true)\n\n    const licensePath = resolveProjectFile('LICENSE', projectLocation, true)\n    const licenseFileName = (license === 'AGPL-3.0') ? 'LICENSE_AGPL3' : 'LICENSE_BOTPRESS'\n    const licenseContent = fs.readFileSync(path.join(licensesPath, licenseFileName))\n\n    const pkg = JSON.parse(fs.readFileSync(packageJsonPath))\n    pkg.license = license\n\n    fs.writeFileSync(licensePath, licenseContent)\n    fs.writeFileSync(packageJsonPath, JSON.stringify(pkg, null, 2))\n  })\n\n  const middleware = listeners.hear(/^BOT_LICENSE$/, (event, next) => {\n    const packageJsonPath = resolveProjectFile('package.json', projectLocation, true)\n    const { license, name, author } = JSON.parse(fs.readFileSync(packageJsonPath))\n    const bp = event.bp\n\n    const response = `Bot:  ${name}\nCreated by: ${author}\nLicense: ${license}\nBotpress: ${bp.version}`\n\n    const userId = event.user && event.user.id\n\n    if (bp[event.platform] && bp[event.platform].sendText) {\n      bp[event.platform].sendText(userId, response)\n    } else {\n      bp.middlewares.sendOutgoing({\n        platform: event.platform,\n        type: 'text',\n        text: response,\n        raw: {\n          to: userId,\n          message: response,\n          responseTo: event\n        }\n      })\n    }\n  })\n\n  const guard = LicenseGuard(logger, db, botfile)\n  guard.start()\n\n  return {\n    getLicensing: async () => {\n      const licenses = getLicenses()\n      let currentLicense = _.find(licenses, { licensedUnder: true })\n      currentLicense = currentLicense || licenses.botpress\n\n      return Object.assign(await guard.getStatus(), {\n        text: currentLicense.text\n      })\n    },\n    changeLicense,\n    middleware,\n    getFeatures: guard.getFeatures\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/licensing.js","import _ from 'lodash'\n\nconst matches = function(conditions, event) {\n  if (!_.isPlainObject(conditions)) {\n    conditions = { text: conditions }\n  }\n\n  const pairs = _.toPairs(conditions)\n  return _.every(pairs, ([key, comparrer]) => {\n    const eventValue = _.get(event, key, null)\n\n    if (_.isFunction(comparrer)) {\n      return comparrer(eventValue, event) === true\n    } else if (_.isRegExp(comparrer)) {\n      return comparrer.test(eventValue)\n    } else {\n      return _.isEqual(comparrer, eventValue)\n    }\n  })\n}\n\nconst hear = function(conditions, callback) {\n  return (event, next) => {\n    const result = matches(conditions, event)\n\n    if (result && _.isFunction(callback)) {\n      if (callback.length <= 1) {\n        if (_.isFunction(next)) { \n          next()\n        }\n        callback(event)\n      } else {\n        callback(event, next)\n      }\n    } else {\n      if (_.isFunction(next)) { \n        next()\n      }\n    }\n  }\n}\n\nmodule.exports = { hear, matches }\n\n\n\n// WEBPACK FOOTER //\n// ./src/listeners.js","module.exports = (logger, db, botfile) => ({\n  // There is no License Guard in the Open-Source / Free version\n  start: () => {},\n  getStatus: async () => {\n    return {\n      licensed: true,\n      name: 'Botpress Community',\n      text: null,\n      status: 'Active'\n    }\n  },\n  getFeatures: () => ({})\n})\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/license/index.js","import winston from 'winston'\nimport path from 'path'\nimport Promise from 'bluebird'\nimport moment from 'moment'\n\nimport { isDeveloping } from './util'\n\nmodule.exports = (dataLocation, logConfig) => {\n  const logger = new winston.Logger({\n    level: isDeveloping ? 'debug' : 'info',\n    transports: [\n      new (winston.transports.Console)({\n        prettyPrint: true,\n        colorize: true,\n        timestamp: () => moment().format('HH:mm:ss')\n      })\n    ]\n  })\n\n  logger.enableFileTransport = () => {\n    const logFile = path.join(dataLocation, logConfig.file)\n    logger.add(winston.transports.File, {\n      filename: logFile,\n      maxsize: logConfig.maxSize\n    })\n  }\n\n  logger.archiveToFile = () => {\n    const logFile = path.join(dataLocation, logConfig.file)\n\n    return Promise.resolve(logFile)\n  }\n\n  if (!logConfig.disableFileLogs) {\n    logger.enableFileTransport()\n  }\n\n  return logger\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/logger.js","module.exports = require(\"winston\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"winston\"\n// module id = 48\n// module chunks = 0","import jwt from 'jsonwebtoken'\nimport _ from 'lodash'\n\nimport Authentication from '+/authentication'\n\n/**\n * Security helper for botpress\n *\n * Constructor of following functions\n *\n *   - login(user, password, ip)\n *   - authenticate(token)\n *   - getSecret()\n *\n * It will find or create a secret.key in `dataLocation`, then setup the adminPassword for user login.\n *\n */\n\nmodule.exports = ({ dataLocation, securityConfig, db }) => {\n\n  const authentication = Authentication({ dataLocation, securityConfig, db })\n  const { tokenExpiry } = securityConfig\n\n  // login function that returns a {success, reason, token} object\n  // accounts for number of bad attempts\n  const login = async function(user, password, ip = 'all') {\n    const canAttempt = await authentication.attempt(ip)\n    if (!canAttempt) {\n      return { success: false, reason: 'Too many login attempts. Try again later.' }\n    }\n\n    const loginUser = await authentication.authenticate(user, password, ip)\n\n    if (loginUser) {\n      const secret = await authentication.getSecret()\n\n      return {\n        success: true,\n        token: jwt.sign({ user: loginUser }, secret, { expiresIn: tokenExpiry })\n      }\n    } else {\n      return {\n        success: false,\n        reason: 'Bad username / password'\n      }\n    }\n  }\n\n  /**\n   * @param {string} token\n   * @return {boolean} whether the token is valid\n   */\n  const authenticate = async function(token) {\n    try {\n      const secret = await authentication.getSecret()\n      const decoded = jwt.verify(token, secret)\n      const verified = authentication.verifyUser\n        ? await authentication.verifyUser(decoded)\n        : true\n      return verified && decoded.user\n    } catch (err) {\n      return false\n    }\n  }\n\n  return {\n    login,\n    authenticate,\n    getSecret: authentication.getSecret,\n    _authentication: authentication\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/security/index.js","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 50\n// module chunks = 0","import fs from 'fs'\nimport path from 'path'\nimport crypto from 'crypto'\nimport Promise from 'bluebird'\n\nmodule.exports = ({ dataLocation, securityConfig }) => {\n\n  // reading secret from data or creating new secret\n  let secret = ''\n  const secretPath = path.join(dataLocation, 'secret.key')\n\n  const createNewSecret = () => {\n    secret = crypto.randomBytes(256).toString()\n    fs.writeFileSync(secretPath, secret)\n    return secret\n  }\n\n  if (fs.existsSync(secretPath)) {\n    secret = fs.readFileSync(secretPath)\n  }\n\n  if (!secret || secret.length < 15) {\n    secret = createNewSecret()\n  }\n\n  const adminPassword = process.env.BOTPRESS_ADMIN_PASSWORD || securityConfig.password\n\n  // a per-ip cache that logs login attempts\n  let attempts = {}\n  let lastCleanTimestamp = new Date()\n  const { maxAttempts, resetAfter } = securityConfig\n\n  function attempt(ip) {\n    // reset the cache if time elapsed\n    if (new Date() - lastCleanTimestamp >= resetAfter) {\n      attempts = {}\n      lastCleanTimestamp = new Date()\n    }\n\n    return (attempts[ip] || 0) < maxAttempts\n  }\n\n  function authenticate(user, password, ip) {\n    if (typeof(user) === 'string' && user.toLowerCase() === 'admin' &&\n      typeof(password) === 'string' && password === adminPassword) {\n      attempts[ip] = 0\n      return {\n        id: 0,\n        email: 'admin@botpress.io',\n        first_name: 'Admin',\n        last_name: 'Admin',\n        avatar_url: null,\n        roles: ['admin']\n      }\n    } else {\n      attempts[ip] = (attempts[ip] || 0) + 1\n      return null\n    }\n  }\n\n  function getSecret() {\n    return secret\n  }\n\n  function resetSecret() {\n    return createNewSecret()\n  }\n\n  // Public API\n  return {\n    attempt: Promise.method(attempt),\n    authenticate: Promise.method(authenticate),\n    getSecret: Promise.method(getSecret),\n    resetSecret: Promise.method(resetSecret)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/authentication/index.js","import _ from 'lodash'\nimport fs from 'fs'\nimport path from 'path'\nimport uuid from 'uuid'\n\nimport { resolveModuleRootPath } from './util'\n\n// TODO this can be an util\nconst createJsonStore = (filePath, initData) => ({\n  load: () => {\n    if (fs.existsSync(filePath)) {\n      return JSON.parse(fs.readFileSync(filePath))\n    }\n\n    return initData\n  },\n\n  save: data => {\n    fs.writeFileSync(filePath, JSON.stringify(data))\n  }\n})\n\nconst bindEvents = (loadNotifs, saveNotifs, events) => {\n  events.on('notifications.getAll', () => {\n    events.emit('notifications.all', loadNotifs())\n  })\n\n  const markReadIf = cond => {\n    const notifications = loadNotifs()\n    .map(notif => {\n      if (cond(notif)) {\n        notif.read = true\n      }\n      return notif\n    })\n\n    saveNotifs(notifications)\n    events.emit('notifications.all', notifications)\n  }\n\n  events.on('notifications.read', (id) => {\n    markReadIf(notif => notif.id === id)\n  })\n\n  events.on('notifications.allRead', () => {\n    markReadIf(() => true)\n  })\n\n  events.on('notifications.trashAll', () => {\n    saveNotifs([])\n    events.emit('notifications.all', [])\n  })\n}\n\nexport default (dataLocation, notifConfig, modules, events, logger) => {\n  const notificationsFile = path.join(dataLocation, notifConfig.file)\n\n  const {\n    load: loadNotifs,\n    save: saveNotifs,\n  } = createJsonStore(notificationsFile, [])\n\n  bindEvents(loadNotifs, saveNotifs, events)\n\n  const sendNotif = ({ message, url, level }) => {\n\n    if (!message || typeof(message) !== 'string') {\n      throw new Error('\\'message\\' is mandatory and should be a string')\n    }\n\n    if (\n      !level || typeof(level) !== 'string' ||\n      !_.includes(['info', 'error', 'success'], level.toLowerCase())\n    ) {\n      level = 'info'\n    } else {\n      level = level.toLowerCase()\n    }\n\n    const callingFile = getOriginatingModule()\n    const callingModuleRoot = callingFile && resolveModuleRootPath(callingFile)\n\n    const module = _.find(modules, (mod) => {\n      return mod.root === callingModuleRoot\n    })\n\n    let options = {\n      // TODO should probably go in settings as defaults\n      moduleId: 'botpress',\n      icon: 'view_module',\n      name: 'botpress',\n      url: url || '/'\n    }\n\n    if (module) {\n      // because the bot itself can send notifications\n      options = {\n        moduleId: module.name,\n        icon: module.settings.menuIcon,\n        name: module.settings.menuText,\n        url: url\n      }\n\n      if (!url || typeof(url) !== 'string') {\n        options.url = `/modules/${module.name}`\n      }\n    }\n\n    const notification = {\n      id: uuid.v4(),\n      message: message,\n      level: level,\n      moduleId: options.moduleId,\n      icon: options.icon,\n      name: options.name,\n      url: options.url,\n      date: new Date(),\n      read: false\n    }\n\n    let notifications = loadNotifs()\n    if (notifications.length >= notifConfig.maxLength) {\n      notifications.pop()\n    }\n\n    notifications.unshift(notification)\n    saveNotifs(notifications)\n\n    events.emit('notifications.new', notification)\n\n    const logMessage = `[notification::${notification.moduleId}] ${notification.message}`\n    if (logger) {\n      (logger[level] || logger.info)(logMessage)\n    }\n  }\n\n  return {\n    load: loadNotifs,\n    save: saveNotifs,\n    send: sendNotif,\n  }\n}\n\nfunction getOriginatingModule() {\n  // TODO Explain hack\n  var origPrepareStackTrace = Error.prepareStackTrace\n  Error.prepareStackTrace = function (_, stack) {\n    return stack\n  }\n  var err = new Error()\n  var stack = err.stack\n  Error.prepareStackTrace = origPrepareStackTrace\n  stack.shift()\n\n  return stack[1].getFileName()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/notifications.js","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 53\n// module chunks = 0","import mware from 'mware'\nimport listeners from './listeners'\n\nmodule.exports = () => {\n\n  const chain = mware()\n  const handler = (event, next) => {\n    chain.run(event, function() {\n      next.apply(this, arguments)\n    })\n  }\n\n  const middleware = {\n    name: 'hear',\n    type: 'incoming',\n    order: 20,\n    module: 'botpress',\n    description: 'The built-in hear convenience middleware',\n    handler: handler\n  }\n\n  const hear = (condition, callback) => {\n    chain(listeners.hear(condition, callback))\n  }\n\n  return { hear, middleware }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/hear.js","import Promise from 'bluebird'\nimport moment from 'moment'\n\nimport tables from './tables'\nimport kvs from './kvs'\n\nconst initializeCoreDatabase = knex => {\n  if (!knex) {\n    throw new Error('You must initialize the database before')\n  }\n\n  return Promise.mapSeries(tables, fn => fn(knex))\n}\n\nconst createKnex = async ({ sqlite, postgres }) => {\n  let _knex = null\n\n  if (postgres.enabled) {\n\n    // If we're passing in a postgres connection string, \n    // use that instead of the other params\n    if (postgres.connection) {\n      _knex = require('knex')({\n        client: 'pg',\n        connection: postgres.connection,\n        useNullAsDefault: true\n      })\n    } else {\n      _knex = require('knex')({\n        client: 'pg',\n        connection: {\n          host: postgres.host,\n          port: postgres.port,\n          user: postgres.user,\n          password: postgres.password,\n          database: postgres.database,\n          ssl: postgres.ssl\n        },\n        useNullAsDefault: true\n      })\n    }\n    \n  } else {\n    _knex = require('knex')({\n      client: 'sqlite3',\n      connection: { filename: sqlite.location },\n      useNullAsDefault: true,\n      pool: { \n        afterCreate: (conn, cb) => {\n          conn.run('PRAGMA foreign_keys = ON', cb)\n        }\n      }\n    })\n  }\n\n  await initializeCoreDatabase(_knex)\n  return _knex\n}\n\nmodule.exports = ({ sqlite, postgres }) => {\n\n  let knex = null\n\n  const getDb = async () => {\n    if (!knex) {\n      knex = createKnex({ sqlite, postgres })\n    }\n\n    return await knex\n  }\n\n  const saveUser = ({ id, platform, gender, timezone, locale, picture_url, first_name, last_name }) => {\n    const userId = platform + ':' + id\n    const userRow = {\n      id: userId,\n      userId: id,\n      platform: platform,\n      gender: gender || 'unknown',\n      timezone: timezone || null,\n      locale: locale || null,\n      created_on: moment(new Date()).toISOString(),\n      picture_url: picture_url,\n      last_name: last_name,\n      first_name: first_name\n    }\n\n    return getDb()\n    .then(knex => {\n      var query = knex('users').insert(userRow)\n      .where(function() {\n        return this\n          .select(knex.raw(1))\n          .from('users')\n          .where('id', '=', userId)\n      })\n\n      if (postgres.enabled) {\n        query = `${query} on conflict (id) do nothing`\n      } else { // SQLite\n        query = query.toString().replace(/^insert/i, 'insert or ignore')\n      }\n\n      return knex.raw(query)\n    })\n  }\n\n  let kvs_instance = null\n\n  const createKvs = async () => {\n    const knex = await getDb()\n    let _kvs = new kvs(knex)\n    await _kvs.bootstrap()\n    return _kvs\n  }\n\n  const getKvs = async () => {\n    if (!kvs_instance) {\n      kvs_instance = createKvs()\n    }\n\n    return await kvs_instance\n  }\n\n  const kvsGet = function() {\n    const args = arguments\n    return getKvs()\n    .then(instance => instance.get.apply(null, args))\n  }\n\n  const kvsSet = function() {\n    const args = arguments\n    return getKvs()\n    .then(instance => instance.set.apply(null, args))\n  }\n\n  return {\n    get: getDb,\n    saveUser,\n    location: postgres.enabled ? 'postgres' : sqlite.location,\n    kvs: { get: kvsGet, set: kvsSet }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/index.js","import { table_factories } from '+/database'\n\nmodule.exports = [\n  require('./users.js')\n].concat(table_factories)\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/tables.js","module.exports = {\n  table_factories: []\n}\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/database/index.js","/*\n  A table storing all the interlocutors (users) and their information\n*/\n\nimport helpers from './helpers'\n\nmodule.exports = knex => {\n  return helpers(knex).createTableIfNotExists('users', function (table) {\n    table.string('id').primary()\n    table.string('userId')\n    table.string('platform')\n    table.enu('gender', ['unknown', 'male', 'female'])\n    table.integer('timezone')\n    table.string('picture_url')\n    table.string('first_name')\n    table.string('last_name')\n    table.string('locale')\n    table.timestamp('created_on')\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/users.js","import fs from 'fs'\nimport { resolveProjectFile } from './util'\n\nmodule.exports = (projectLocation) => {\n\n  const getBotInformation = () => {\n    const packageJsonPath = resolveProjectFile('package.json', projectLocation, true)\n    const packageJson = JSON.parse(fs.readFileSync(packageJsonPath))\n\n    return {\n      name: packageJson.name,\n      version: packageJson.version,\n      description: packageJson.description || '<no description>',\n      author: packageJson.author || '<no author>',\n      license: packageJson.license || 'AGPL-v3.0'\n    }\n  }\n\n  return { getBotInformation }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/about.js","import EventEmmiter from 'eventemitter2'\nimport ms from 'ms'\nimport _ from 'lodash'\nimport Promise from 'bluebird'\n\nimport { matches } from './listeners'\n\nconst INTERVAL_MSGS = 5000\n\nconst formatMessage = (msg, initialEvent) => {\n  if (typeof msg === 'string') {\n    return {\n      platform: initialEvent.platform,\n      user: initialEvent.user,\n      type: 'text',\n      text: msg,\n      raw: {\n        user: initialEvent.user,\n        message: msg\n      }\n    }\n  } else if (typeof msg === 'function') {\n    // This is a 'wrapped' or 'delayed' execution message\n    // It is going to be evaluated at send time, this this has a risk of failing\n    // If the function execution fails\n    return msg\n  } else {\n    if (msg && msg.type && msg.platform && msg.text) {\n      return msg\n    } else {\n      throw new Error('Invalid message: ', msg)\n    }\n  }\n}\n\nconst validateHandlers = handlers => {\n  // TODO\n}\n\nclass Thread extends EventEmmiter {\n\n  constructor(name, bp, convo) {\n    super()\n    this.initialEvent = convo.initialEvent\n    this.name = name\n    this.bp = bp\n    this.convo = convo\n    this.queue = [] // Queue of messages and questions to say / ask next\n    this.archive = [] // Archive of unqueued questions. We store them so we can re-create (restart) the thread.\n    this.waiting = false // Thread is waiting when it asked for a question\n    this._last = null\n  }\n\n  enqueue(message) {\n    this.queue.push(message)\n    this.archive.push(message)\n  }\n\n  addMessage(msg) {\n    const message = formatMessage(msg, this.initialEvent)\n\n    this.enqueue({\n      type: 'message',\n      message: message\n    })\n  }\n\n  addQuestion(msg, handlers) {\n    validateHandlers(handlers)\n    const message = formatMessage(msg, this.initialEvent)\n\n    this.enqueue({\n      type: 'question',\n      message: message,\n      handlers: handlers\n    })\n  }\n\n  peek() {\n    return this.queue.length > 0 ? this.queue[0] : null\n  }\n\n  dequeue() {\n    const msg = this.queue.shift()\n\n    this._last = msg\n    this.waiting = msg && msg.type === 'question'\n\n    if (!msg) {\n      this.emit('done')\n    }\n\n    return msg\n  }\n\n  process(event) {\n    const handlers = (this.waiting && this._last && this._last.handlers) || []\n\n    for (let handler of handlers) {\n      if (handler.pattern && matches(handler.pattern, event)) {\n        if (_.isRegExp(handler.pattern)) {\n          const match = handler.pattern.exec(event.text)\n          if (match) {\n            event.match = match[1]\n          }\n        }\n\n        handler.callback && handler.callback(event)\n        return // Interrupt further processing\n      }\n    }\n\n    const defaultHandler = _.find(handlers, { default: true })\n\n    defaultHandler && defaultHandler.callback && defaultHandler.callback(event)\n  }\n\n  repeat() {\n    return this._last && this._last.message\n  }\n\n  restart() {\n    this.queue = this.archive.map(i => i)\n    this._last = null\n    this.waiting = false\n  }\n}\n\nclass Conversation extends EventEmmiter {\n\n  constructor({ initialEvent, middleware, logger, messageTypes, clockSpeed = 500 }) {\n    super()\n    this.logger = logger\n    this.middleware = middleware\n    this.initialEvent = initialEvent\n    this._threads = {}\n    this.currentThread = null\n    this.defaultThread = this.createThread('default')\n    this.status = 'new'\n    this.get = this._get\n    this.set = this._set\n    this._cache = {}\n    this.intervalBetweenMessages = INTERVAL_MSGS\n    this._timeoutHandle = null\n    this._timeoutInterval = ms('5 minutes')\n    this._useTimeout = false\n    this._clock = setInterval(::this.tick, clockSpeed)\n    this._clockSpeed = clockSpeed\n    this._processing = false\n    this.messageTypes = messageTypes || ['message', 'text', 'quick_reply']\n    this._outgoing = []\n    this.endWhenDone = true\n\n    this.sendNext() // Infinite loop. Must be called only once.\n  }\n\n  get threads() {\n    return Object.assign({}, this._threads)\n  }\n\n  async sendNext() {\n    const msg = this._outgoing.shift()\n\n    if (msg) {\n      await Promise.resolve(this.middleware\n      && this.middleware.sendOutgoing \n      && this.middleware.sendOutgoing(msg))\n    }\n\n    await Promise.delay(this._clockSpeed)\n    \n    if (this.status === 'active' || this._outgoing.length > 0) {\n      setImmediate(::this.sendNext)\n    }\n  }\n\n  teardown() {\n    // Dispose of timeouts and intervals\n    clearInterval(this._clock)\n    this.clearTimeout()\n    this.status = 'destroyed'\n  }\n\n  getCurrentThread() {\n    return this._threads[this.currentThread]\n  }\n\n  tick() {\n    const thread = this.getCurrentThread()\n    if (this.status === 'active' && !thread.waiting && !!thread.peek()) {\n      this.next()\n    }\n  }\n\n  clearTimeout() {\n    if (this._timeoutHandle) {\n      this.clearTimeout(this._timeoutHandle)\n    }\n  }\n\n  resetTimeout() {\n    this.clearTimeout()\n\n    this._timeoutHandle = this._useTimeout && setTimeout(() => {\n      // TODO If there's a timeout thread, switch to it\n      this.emit('timeout')\n    }, this._timeoutInterval)\n  }\n\n  createThread(name) {\n    const thread = new Thread(name, this.bp, this)\n    this._threads[name] = thread\n\n    if (!this.currentThread) {\n      this.currentThread = name\n    }\n\n    return thread\n  }\n\n  async switchTo(name, restart = true) {\n    if (this.currentThread === name) {\n      return // Don't switch if it's already the current thread\n    }\n\n    if (!this._threads[name]) {\n      throw new Error(`Thread \"${name}\" doesn't exist`)\n    }\n\n    const before = await this.emitAsync('beforeSwitch', name)\n    if (_.some(before, a => a === false)) {\n      return // Aborted thread switch\n    }\n\n    this.currentThread = name\n\n    if (restart) {\n      const thread = this.getCurrentThread()\n      thread && thread.restart()\n    }\n\n    this.emit('switched', name)\n  }\n\n  next() {\n    const thread = this.getCurrentThread()\n    const msg = thread.dequeue()\n    if (msg) {\n      let message = msg.message\n\n      if (typeof message === 'function') {\n        // Executes (unwrap) the message on the fly\n        message = msg.message()\n      }\n\n      this.say(message, this.initialEvent)\n    } else {\n      this.endWhenDone && this.stop('done')\n    }\n  }\n\n  async processIncoming(event) {\n\n    if (!_.includes(this.messageTypes, event.type)) {\n      return\n    }\n\n    this._timeoutHandle && this.resetTimeout()\n    const before = await this.emitAsync('beforeProcessing', event)\n    if (_.some(before, a => a === false)) {\n      return\n    }\n\n    const thread = this.getCurrentThread()\n    thread && thread.waiting && thread.process(event)\n  }\n\n  setTimeout(timeout) {\n    this._useTimeout = true\n    this._timeoutInterval = typeof timeout === 'number' ? timeout : ms(timeout)\n    this.resetTimeout()\n  }\n\n  async say(msg) {\n    const message = formatMessage(msg)\n    this._outgoing.push(msg)\n\n    if (this.status !== 'active') {\n      this.sendNext() // restart sending process once\n    }\n  }\n\n  activate() {\n    if (this.status === 'new') {\n      this.status = 'active'\n      this.emit('activated')\n    } else {\n      throw new Error('Conversation was already activated')\n    }\n  }\n\n  getStatus() {\n    return this.status\n  }\n\n  _get(name) {\n    return this._cache[name]\n  }\n\n  _set(name, value) {\n    this._cache[name] = value\n  }\n\n  async repeat() {\n    const thread = this._threads[this.currentThread]\n    const msg = thread && thread.repeat()\n\n    if (msg) {\n      return this.say(msg)\n    }\n  }\n\n  stop(reason) {\n    this.status = reason\n    this.emit(reason)\n\n    if (reason !== 'stop') {\n      this.emit('stop', reason)\n    }\n    this.teardown()\n  }\n}\n\nmodule.exports = ({ logger, middleware, clockSpeed = 500 }) => {\n  let convos = []\n\n  const belongsToConvo = (convo, event) => {\n    const initial = convo.initialEvent\n\n    return convo.initialEvent.platform === event.platform\n      && _.get(initial, 'user.id', '') === _.get(event, 'user.id', '')\n  }\n\n  middleware.register({\n    name: 'conversations',\n    type: 'incoming',\n    order: 25,\n    module: 'botpress',\n    description: 'Built-in conversation flow manager',\n    handler: function(event, next) {\n\n      // Clean up and free from memory ended conversations\n      convos = _.filter(convos, c => {\n        return _.includes(['new', 'active'], c.status)\n      })\n\n      for (let convo of convos) {\n        if (belongsToConvo(convo, event) && convo.status === 'active') {\n          convo.processIncoming(event)\n          return // Stop the processing, only one convo per event. Swallow the event\n        }\n      }\n\n      next && next() // Don't swallow the event\n    }\n  })\n\n  const validateEvent = event => {\n    if (!event || !event.type || !event.platform) {\n      throw new Error('You need to pass an original incoming event to start a conversation')\n    }\n  }\n\n  function start(event, callback) {\n    const convo = create(event)\n    callback && callback(convo)\n\n    convo.activate()\n    return convo\n  }\n\n  function create(event) {\n    validateEvent(event)\n    const convo = new Conversation({\n      logger,\n      middleware,\n      clockSpeed,\n      initialEvent: event\n    })\n    convos.push(convo)\n    return convo\n  }\n\n  function find(event) {\n    for (let convo of convos) {\n      if (belongsToConvo(convo, event) && convo.status === 'active') {\n        return convo\n      }\n    }\n  }\n\n  function destroy() {\n    for (let convo of convos) {\n      convo.teardown()\n    }\n\n    convos = []\n  }\n\n  return { start, create, find, destroy }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/conversations.js","module.exports = require(\"ms\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ms\"\n// module id = 61\n// module chunks = 0","module.exports = {\n\t\"name\": \"botpress\",\n\t\"description\": \"The world's first CMS for bots. Easily create, manage and extend chatbots.\",\n\t\"version\": \"0.2.4\",\n\t\"author\": \"Botpress\",\n\t\"bin\": {\n\t\t\"bp\": \"./bin/botpress\",\n\t\t\"botpress\": \"./bin/botpress\"\n\t},\n\t\"bugs\": {\n\t\t\"url\": \"https://github.com/botpress/botpress/issues\"\n\t},\n\t\"dependencies\": {\n\t\t\"axios\": \"^0.15.2\",\n\t\t\"babel-polyfill\": \"^6.23.0\",\n\t\t\"bluebird\": \"^3.4.6\",\n\t\t\"body-parser\": \"^1.15.2\",\n\t\t\"chalk\": \"^1.1.3\",\n\t\t\"commander\": \"^2.9.0\",\n\t\t\"dotenv\": \"^4.0.0\",\n\t\t\"email-templates\": \"^2.5.4\",\n\t\t\"eventemitter2\": \"^2.1.3\",\n\t\t\"express\": \"^4.14.0\",\n\t\t\"formidable\": \"^1.1.1\",\n\t\t\"handlebars\": \"^4.0.6\",\n\t\t\"jsonwebtoken\": \"^7.1.9\",\n\t\t\"knex\": \"^0.12.6\",\n\t\t\"lodash\": \"^4.16.4\",\n\t\t\"moment\": \"^2.15.1\",\n\t\t\"ms\": \"^0.7.1\",\n\t\t\"mware\": \"0.0.3\",\n\t\t\"node-machine-id\": \"^1.1.3\",\n\t\t\"node-sass\": \"^3.13.1\",\n\t\t\"nodemailer\": \"^2.7.2\",\n\t\t\"pg\": \"^6.1.2\",\n\t\t\"prompt\": \"^1.0.0\",\n\t\t\"socket.io\": \"^1.5.0\",\n\t\t\"socketio-jwt\": \"^4.5.0\",\n\t\t\"source-map-support\": \"^0.4.6\",\n\t\t\"sqlite3\": \"^3.1.8\",\n\t\t\"universal-analytics\": \"^0.4.8\",\n\t\t\"uuid\": \"^3.0.0\",\n\t\t\"winston\": \"^2.2.0\"\n\t},\n\t\"devDependencies\": {\n\t\t\"autoprefixer\": \"^6.5.3\",\n\t\t\"babel-cli\": \"^6.16.0\",\n\t\t\"babel-core\": \"^6.18.0\",\n\t\t\"babel-eslint\": \"^7.1.0\",\n\t\t\"babel-loader\": \"^6.2.5\",\n\t\t\"babel-plugin-root-import\": \"^5.1.0\",\n\t\t\"babel-plugin-transform-decorators-legacy\": \"^1.3.4\",\n\t\t\"babel-plugin-transform-object-rest-spread\": \"^6.16.0\",\n\t\t\"babel-preset-latest\": \"^6.16.0\",\n\t\t\"babel-preset-react\": \"^6.11.1\",\n\t\t\"babel-preset-stage-0\": \"^6.16.0\",\n\t\t\"babel-register\": \"^6.16.3\",\n\t\t\"bootstrap\": \"^3.3.7\",\n\t\t\"chai\": \"^3.5.0\",\n\t\t\"classnames\": \"^2.2.5\",\n\t\t\"copy-webpack-plugin\": \"^4.0.0\",\n\t\t\"css-loader\": \"^0.25.0\",\n\t\t\"eslint\": \"^3.9.0\",\n\t\t\"exports-loader\": \"^0.6.3\",\n\t\t\"expose-loader\": \"^0.7.1\",\n\t\t\"extract-text-webpack-plugin\": \"^1.0.1\",\n\t\t\"file-loader\": \"^0.9.0\",\n\t\t\"hard-source-webpack-plugin\": \"^0.3.7\",\n\t\t\"history\": \"^2.1.2\",\n\t\t\"json-loader\": \"^0.5.4\",\n\t\t\"keymirror\": \"^0.1.1\",\n\t\t\"mocha\": \"^3.1.2\",\n\t\t\"npm-watch\": \"^0.1.6\",\n\t\t\"nuclear-js\": \"^1.4.0\",\n\t\t\"nuclear-js-react-addons\": \"^0.4.1\",\n\t\t\"postcss-loader\": \"^1.1.1\",\n\t\t\"prop-types\": \"^15.5.8\",\n\t\t\"react\": \"^15.3.1\",\n\t\t\"react-addons-css-transition-group\": \"^15.3.1\",\n\t\t\"react-addons-update\": \"^15.4.2\",\n\t\t\"react-bootstrap\": \"^0.30.3\",\n\t\t\"react-bootstrap-button-loader\": \"^1.0.7\",\n\t\t\"react-dom\": \"^15.3.1\",\n\t\t\"react-emoji\": \"^0.4.4\",\n\t\t\"react-fontawesome\": \"^1.2.0\",\n\t\t\"react-ga\": \"^2.1.2\",\n\t\t\"react-markdown\": \"^2.4.5\",\n\t\t\"react-router\": \"^2.8.1\",\n\t\t\"react-sidebar\": \"^2.2.1\",\n\t\t\"react-sortable\": \"^1.2.0\",\n\t\t\"sass-loader\": \"^4.0.2\",\n\t\t\"script-loader\": \"^0.7.0\",\n\t\t\"simple-line-icons\": \"^2.4.1\",\n\t\t\"sinon\": \"^1.17.7\",\n\t\t\"style-loader\": \"^0.13.1\",\n\t\t\"tmp\": \"0.0.31\",\n\t\t\"webpack\": \"^1.13.2\",\n\t\t\"webpack-node-externals\": \"^1.5.4\"\n\t},\n\t\"engines\": {\n\t\t\"node\": \">=4.6.0\"\n\t},\n\t\"homepage\": \"https://github.com/botpress/botpress#readme\",\n\t\"keywords\": [\n\t\t\"bots\",\n\t\t\"chatbots\",\n\t\t\"bot framework\",\n\t\t\"messenger\",\n\t\t\"facebook\",\n\t\t\"slack\",\n\t\t\"botkit\",\n\t\t\"microsoft bot framework\",\n\t\t\"bot builder\",\n\t\t\"bot\",\n\t\t\"chatbot\",\n\t\t\"api\"\n\t],\n\t\"license\": \"AGPL-3.0\",\n\t\"main\": \"lib/node.bundle.js\",\n\t\"repository\": \"git+https://github.com/botpress/botpress.git\",\n\t\"os\": [\n\t\t\"darwin\",\n\t\t\"linux\",\n\t\t\"win32\"\n\t],\n\t\"scripts\": {\n\t\t\"compile\": \"./build.sh\",\n\t\t\"test\": \"BABEL_ENV=tests mocha --compilers js:babel-core/register --require tests/index.js tests/** extensions/**/tests/**\",\n\t\t\"watch\": \"npm-watch\",\n\t\t\"lint\": \"eslint {src,extensions}/**/*.js*\"\n\t},\n\t\"watch\": {\n\t\t\"compile\": {\n\t\t\t\"patterns\": [\n\t\t\t\t\"src\",\n\t\t\t\t\"extensions\"\n\t\t\t],\n\t\t\t\"extensions\": \"js,jsx,scss,json,html\"\n\t\t}\n\t}\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./package.json\n// module id = 62\n// module chunks = 0","module.exports = () => {}\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/emails/index.js","module.exports = bp => ({\n  install: () => {},\n  uninstall: () => {}\n})\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/mediator/index.js","import express from 'express'\nimport http from 'http'\n\nimport Socket from './socket'\nimport Static from './static'\nimport Api from './api'\n\nmodule.exports = bp => {\n\n  async function serveApi(app) {\n    const api = Api(bp)\n    return api.install(app)\n  }\n\n  async function serveSocket(server) {\n    const socket = Socket(bp)\n    return socket.install(server)\n  }\n\n  async function serveStatic(app) {\n    const staticStuff = Static(bp)\n    return staticStuff.install(app)\n  }\n\n  async function start() {\n    const app = express()\n    const server = http.createServer(app)\n    const port = bp.botfile.port\n\n    await serveApi(app)\n    await serveSocket(server)\n    await serveStatic(app)\n\n    return new Promise(resolve => {\n      server.listen(port, () => resolve())\n    })\n  }\n\n  return { start }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/index.js","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 66\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 67\n// module chunks = 0","import socketio from 'socket.io'\nimport socketioJwt from 'socketio-jwt'\n\nmodule.exports = bp => {\n\n  async function install(server) {\n    const io = socketio(server)\n\n    if (bp.botfile.login.enabled) {\n      io.use(socketioJwt.authorize({\n        secret: await bp.security.getSecret(),\n        handshake: true\n      }))\n    }\n\n    io.on('connection', function(socket) {\n      bp.stats.track('socket', 'connected')\n\n      socket.on('event', function(event) {\n        bp.events.emit(event.name, event.data, 'client')\n      })\n    })\n\n    bp.events.onAny(function(event, data, from) {\n      if (from === 'client') {\n        return // we sent this ourselves\n      }\n\n      // broadcast event to the front-end clients\n      io.emit('event', {\n        name: event,\n        data: data\n      })\n    })\n  }\n\n  return { install }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/socket.js","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 69\n// module chunks = 0","module.exports = require(\"socketio-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socketio-jwt\"\n// module id = 70\n// module chunks = 0","/* global BP_EDITION */\n\nimport Promise from 'bluebird'\nimport express from 'express'\nimport path from 'path'\nimport fs from 'fs'\nimport ms from 'ms'\nimport sass from 'node-sass'\nimport util from '../util'\n\nmodule.exports = bp => {\n\n  function serveModule(app, module) {\n    const name = module.name\n    const bundlePath = path.join(module.root, module.settings.webBundle || 'bin/web.bundle.js')\n    const requestPath = `/js/modules/${name}.js`\n\n    if (module.settings.menuIcon === 'custom') {\n      const iconRequestPath = `/img/modules/${name}.png`\n      const iconPath = path.join(module.root, 'icon.png')\n\n      app.use(iconRequestPath, (req, res) => {\n        try {\n          const content = fs.readFileSync(iconPath)\n          res.contentType('image/png')\n          res.send(content)\n        } catch (err) {\n          bp.logger.warn(`Could not serve module icon [${name}] at: ${iconPath}`)\n        }\n      })\n    }\n\n    app.use(requestPath, (req, res) => {\n      try {\n        const content = fs.readFileSync(bundlePath)\n        res.contentType('text/javascript')\n        res.send(content)\n      } catch (err) {\n        bp.logger.warn(`Could not serve module [${name}] at: ${bundlePath}`)\n      }\n    })\n  }\n\n  function serveCustomTheme(app) {\n\n    if (BP_EDITION === 'lite') {\n      return\n    }\n\n    if (bp.licensing.getFeatures().whitelabel !== true) {\n      return\n    }\n\n    let customTheme = ''\n    const themeLocation = path.join(bp.projectLocation, 'theme.scss')\n    if (fs.existsSync(themeLocation)) {\n      const content = fs.readFileSync(themeLocation)\n      const compile = sass.renderSync({ data: `#app {${content}}` })\n      customTheme = compile.css.toString()\n    }\n\n    app.use('/style/custom-theme.css', (req, res) => {\n      res.contentType('text/css')\n      res.send(customTheme)\n    })\n  }\n\n  async function install(app) {\n\n    for (let name in bp._loadedModules) {\n      const module = bp._loadedModules[name]\n      serveModule(app, module)\n    }\n\n    app.use('/js/env.js', (req, res) => {\n      const { tokenExpiry, enabled } = bp.botfile.login\n      const optOutStats = !!bp.botfile.optOutStats\n      const appName = bp.botfile.appName || 'Botpress'\n      \n      const { isFirstRun, version } = bp\n      res.contentType('text/javascript')\n      res.send(`(function(window) {\n        window.NODE_ENV = \"${process.env.NODE_ENV || 'development'}\";\n        window.DEV_MODE = ${util.isDeveloping};\n        window.AUTH_ENABLED = ${enabled};\n        window.AUTH_TOKEN_DURATION = ${ms(tokenExpiry)};\n        window.OPT_OUT_STATS = ${optOutStats};\n        window.SHOW_GUIDED_TOUR = ${isFirstRun};\n        window.BOTPRESS_VERSION = \"${version}\";\n        window.APP_NAME = \"${appName}\";\n      })(window || {})`)\n    })\n\n    serveCustomTheme(app)\n\n    app.use(express.static(path.join(bp.projectLocation, 'static')))\n    \n    app.use(express.static(path.join(__dirname, '../lib/web')))\n\n    app.get('*', (req, res, next) => {\n      if (/html/i.test(req.headers.accept)) {\n        return res.sendFile(path.join(__dirname, '../lib/web/index.html'))\n      }\n      next()\n    })\n\n    return Promise.resolve(true)\n  }\n\n  return { install }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/static.js","module.exports = require(\"node-sass\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-sass\"\n// module id = 72\n// module chunks = 0","import _ from 'lodash'\nimport bodyParser from 'body-parser'\nimport express from 'express'\n\nimport ServiceLocator from '+/ServiceLocator'\nimport anonymousApis from './anonymous'\nimport securedApis from './secured'\n\nconst routersConditions = {}\nconst routers = {}\n\nmodule.exports = bp => {\n\n  async function _authenticationMiddleware(req, res, next) {\n    res.maybeSendRequireLogin = () => {\n      if (!bp.botfile.login.enabled) {\n        res.status(400).send({\n          message: 'Login must be turned on for this API method'\n        })\n        \n        return true\n      } else {\n        return false\n      }\n    }\n\n    if (!bp.botfile.login.enabled) {\n      return next()\n    }\n\n    const user = await bp.security.authenticate(req.headers.authorization)\n    if (!!user) {\n      req.user = user\n      next()\n    } else {\n      res.status(401).location('/login').end()\n    }\n  }\n\n  function installRouter(app) {\n    bp.getRouter = function(name, conditions) {\n      if (!/^botpress-/.test(name)) {\n        throw new Error(`The name of a router must start with 'botpress-'. Received: ${name}`)\n      }\n\n      if (!routers[name]) {\n        const router = express.Router()\n        routers[name] = router\n        app.use(`/api/${name}/`, router)\n      }\n\n      if (conditions) {\n        routersConditions[name] = Object.assign(routersConditions[name] || {}, conditions)\n      }\n\n      installProtector(routers[name])\n      return routers[name]\n    }\n  }\n\n  function installProtector(app) {\n    app.secure = function(operation, ressource) {\n\n      const wrap = method => function(name, handler) {\n        return app[method].call(app, name, async function(req, res, next) {\n          try {\n            if (!req.user) {\n              return handler(req, res, next)\n            }\n\n            const authorizeApi = await ServiceLocator.getService('authorizeApi', false)\n\n            if (!authorizeApi) {\n              return handler(req, res, next)\n            }\n\n            const authorized = await authorizeApi({ userId: req.user.id, operation, ressource })\n\n            if (authorized) {\n              return handler(req, res, next)\n            }\n\n            return res.sendStatus(403) // HTTP Forbidden\n          } catch (err) {\n            return res.status(500).send({ message: err.message })\n          }\n        })\n      }\n\n      return { \n        get: wrap('get'),\n        post: wrap('post'),\n        put: wrap('put'),\n        delete: wrap('delete')\n      }\n    }\n  }\n\n  function installMaybeUse(app) {\n    app.maybeUse = function() {\n      if (arguments.length === 3) {\n        app.use(arguments[0], maybeApply(arguments[1], arguments[2]))\n      } else if (arguments.length === 2) {\n        app.use(maybeApply(arguments[0], arguments[1]))\n      }\n    }\n  }\n\n  async function install(app) {\n    installRouter(app)\n    installProtector(app)\n    installMaybeUse(app)\n\n    app.maybeUse('bodyParser.json', bodyParser.json())\n    app.maybeUse('bodyParser.urlencoded', bodyParser.urlencoded({ extended: true }))\n\n    anonymousApis(bp, app)\n\n    app.use('/api/*', maybeApply('auth', _authenticationMiddleware))\n\n    securedApis(bp, app)\n  }\n\n  return { install }\n}\n\nfunction maybeApply(name, fn) {\n  return (req, res, next) => {\n    const router = req.originalUrl.match(/\\/api\\/(botpress-[^\\/]+).*$/i)\n    if (!router) {\n      return fn(req, res, next)\n    }\n\n    if (!routersConditions[router[1]]) {\n      return fn(req, res, next)\n    }\n\n    const condition = routersConditions[router[1]][name]\n    if (condition === false) {\n      next()\n    } else if (typeof(condition) === 'function' && condition(req) === false) {\n      next()\n    } else {\n      return fn(req, res, next)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/api.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 74\n// module chunks = 0","import ExtraApiProviders from '+/api'\n\nmodule.exports = (bp, app) => {\n\n  app.post('/api/login', async (req, res) => {\n    bp.stats.track('api', 'auth', 'login')\n    const result = await bp.security.login(req.body.user, req.body.password, req.ip)\n    res.send(result)\n  })\n\n  const apis = ExtraApiProviders(bp, app)\n  apis.anonymous.map(x => x && x()) // Install all anonymous APIs\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/anonymous.js","import accounts from '+/api/accounts'\n\nmodule.exports = (bp, app) => ({\n  anonymous: [accounts(bp, app).installAnonymous],\n  secured: [accounts(bp, app).installSecured]\n})\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/api/index.js","module.exports = (bp, app) => {\n\n  const installSecured = () => {\n    \n    app.get('/api/my-account', async (req, res) => {\n      res.send(req.user)\n    })\n\n  }\n\n  const installAnonymous = () => {}\n\n  return {\n    name: '[Lite] Accounts Management',\n    installSecured,\n    installAnonymous\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/api/accounts.js","import _ from 'lodash'\nimport fs from 'fs'\nimport path from 'path'\nimport uuid from 'uuid'\n\nimport util from '../util'\nimport ExtraApiProviders from '+/api'\n\nlet logsSecret = uuid.v4()\n\nmodule.exports = (bp, app) => {\n\n  app.get('/api/ping', (req, res) => {\n    res.send('pong')\n  })\n\n  app.secure('read', 'modules/list')\n  .get('/api/modules', (req, res) => {\n    const modules = _.map(bp._loadedModules, (module) => {\n      return {\n        name: module.name,\n        homepage: module.homepage,\n        menuText: module.settings.menuText || module.name,\n        menuIcon: module.settings.menuIcon || 'view_module',\n        noInterface: !!module.settings.noInterface\n      }\n    })\n    res.send(modules)\n  })\n\n  app.secure('read', 'middleware/list')\n  .get('/api/middlewares', (req, res) => {\n    res.send(bp.middlewares.list())\n  })\n\n  app.secure('write', 'middleware/customizations')\n  .post('/api/middlewares/customizations', (req, res) => {\n    bp.stats.track('api', 'middlewares', 'customizations')\n    const { middlewares } = req.body\n    bp.middlewares.setCustomizations(middlewares)\n    bp.middlewares.load()\n    res.send(bp.middlewares.list())\n  })\n\n  app.secure('write', 'middleware/customizations')\n  .delete('/api/middlewares/customizations', (req, res) => {\n    bp.stats.track('api', 'middlewares', 'customizations')\n    bp.middlewares.resetCustomizations()\n    bp.middlewares.load()\n    res.send(bp.middlewares.list())\n  })\n\n  app.secure('read', 'notifications')\n  .get('/api/notifications', (req, res) => {\n    res.send(bp.notifications.load())\n  })\n\n  app.secure('read', 'bot/information')\n  .get('/api/bot/information', (req, res) => {\n    res.send(bp.about.getBotInformation())\n  })\n\n  app.secure('read', 'modules/list/community')\n  .get('/api/module/all', (req, res) => {\n    bp.modules.listAllCommunityModules()\n    .then(modules => res.send(modules))\n  })\n\n  app.secure('read', 'modules/list/community')\n  .get('/api/module/hero', (req, res) => {\n    bp.modules.getRandomCommunityHero()\n    .then(hero => res.send(hero))\n  })\n\n  app.get('/api/bot/production', (req, res) => {\n    res.send(!util.isDeveloping)\n  })\n\n  app.secure('read', 'modules/list/community')\n  .get('/api/bot/contributor', (req, res) => {\n    res.send(bp.bot.getContributor())\n  })\n\n  app.get('/api/license', async (req, res) => {\n    res.send(await bp.licensing.getLicensing())\n  })\n\n  app.secure('write', 'bot/information/license')\n  .post('/api/license', (req, res) => {\n    bp.stats.track('api', 'license', 'change')\n    bp.licensing.changeLicense(req.body.license)\n    .then(() => {\n      res.sendStatus(200)\n    })\n    .catch(err => res.status(500).send({\n      message: err && err.message\n    }))\n  })\n\n  app.secure('write', 'modules/list/install')\n  .post('/api/module/install/:name', (req, res) => {\n    bp.stats.track('api', 'modules', 'install')\n    const { name } = req.params\n    bp.modules.install(name)\n    .then(() => {\n      res.sendStatus(200)\n      bp.restart(1000)\n    })\n    .catch(err => res.status(500).send({\n      message: err && err.message\n    }))\n  })\n\n  app.secure('write', 'modules/list/uninstall')\n  .delete('/api/module/uninstall/:name', (req, res) => {\n    bp.stats.track('api', 'modules', 'uninstall')\n    const { name } = req.params\n    bp.modules.uninstall(name)\n    .then(() => {\n      res.sendStatus(200)\n      bp.restart(1000)\n    })\n    .catch(err => res.status(500).send({\n      message: err && err.message\n    }))\n  })\n\n  app.delete('/api/guided-tour', (req, res) => {\n    fs.unlink(path.join(bp.projectLocation, '.welcome'), () => {\n      bp.isFirstRun = false\n      res.sendStatus(200)\n    })\n  })\n\n  app.secure('read', 'bot/logs')\n  .get('/api/logs', (req, res) => {\n    const options = {\n      from: new Date() - 7 * 24 * 60 * 60 * 1000,\n      until: new Date(),\n      limit: (req.query && req.query.limit) || 50,\n      start: 0,\n      order: 'desc',\n      fields: ['message', 'level', 'timestamp']\n    }\n\n    bp.logger.query(options, (err, results) => {\n      if (err) { return console.log(err) }\n      res.send(results.file)\n    })\n  })\n\n  app.secure('read', 'bot/logs')\n  .get('/api/logs/key', (req, res) => {\n    res.send({ secret: logsSecret })\n  })\n\n  app.secure('read', 'bot/logs/archive')\n  .get('/logs/archive/:key', (req, res) => {\n    bp.stats.track('api', 'logs', 'archive')\n    if (req.params.key !== logsSecret) {\n      return res.sendStatus(403)\n    }\n\n    bp.logger.archiveToFile()\n    .then((archivePath) => {\n      logsSecret = uuid.v4()\n      res.download(archivePath)\n    })\n  })\n\n  const apis = ExtraApiProviders(bp, app)\n  apis.secured.map(x => x && x()) // Install all secured APIs\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/secured.js"],"sourceRoot":""}