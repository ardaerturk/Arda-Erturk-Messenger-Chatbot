{"version":3,"sources":["webpack:///webpack/bootstrap bf5b3009c805ddbf23fc","webpack:///./src/index.js","webpack:///external \"botpress-version-manager\"","webpack:///external \"path\"","webpack:///external \"fs-extra\"","webpack:///external \"lodash\"","webpack:///external \"rivescript\"","webpack:///./src/calls.js","webpack:///external \"bluebird\"","webpack:///./src/deliveries.js"],"names":["rs","utf8","validateRiveName","name","test","handleMessage","event","id","user","platform","sendTo","text","sendText","options","setUservar","setUservars","replyAsync","then","forEach","delivery","reply","send","handler","exec","bp","err","logger","error","next","incomingMiddleware","channel","type","raw","author","messenger","irc","sendMessage","discord","isPrivate","isSelf","Error","module","exports","init","__dirname","middlewares","register","order","description","rivescript","setUtf8","value","reloadRiveScript","ready","riveDirectory","join","dataLocation","existsSync","mkdirSync","copySync","saveMemory","write","usersVars","users","keys","_users","getUservars","db","kvs","set","restoreMemory","debug","get","content","isUtf8","process","env","RIVESCRIPT_UTF8","loadDirectory","batchNumber","sortReplies","console","log","setInterval","router","getRouter","req","res","data","files","readdirSync","file","replace","readFileSync","toString","delete","params","length","filePath","unlinkSync","sendStatus","post","body","overwrite","writeFileSync","wait","ms","delay","setSubroutine","jsDelivery","match","fn","Function"],"mappings":"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","file":"node.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/Users/slvn/Desktop/botpress-rivescript\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap bf5b3009c805ddbf23fc","import checkVersion from 'botpress-version-manager'\n\nimport path from 'path'\nimport fs from 'fs-extra'\nimport _ from 'lodash'\n\nimport RiveScript from 'rivescript'\n\nimport calls from './calls'\nimport deliveries from './deliveries'\n\nvar rs = null\nvar utf8 = false\n\nconst validateRiveName = (name) => /[A-Z0-9_-]+/i.test(name)\n\nconst handleMessage = (event, id, user, platform, sendTo, text, sendText) => {\n  const options = {}\n  rs.setUservar(id, 'platform', platform)\n  rs.setUservars(id, user)\n  rs.replyAsync(id, text)\n  .then(reply => {\n    deliveries.forEach(delivery => {\n      if(delivery && delivery.test.test(reply)) {\n        const send = (reply, options) => {\n          sendText(sendTo, reply, options)\n        }\n        try {\n          delivery.handler(delivery.test.exec(reply), rs, event.bp, event, send)\n        } catch(err) {\n          event.bp.logger.error(err)\n          throw err\n        }\n        next()\n        return\n      }\n    })\n    sendText(sendTo, reply, options)\n  })\n}\n\nconst incomingMiddleware = (event, next) => {\n  const { user, channel, platform, bp, text, type, raw, author } = event\n  if (platform === 'facebook') {\n    if (type !== 'message') {\n      return next()\n    }\n    handleMessage(event, user.id, user, platform, user.id, text, bp.messenger.sendText)\n  } else if(platform === \"irc\") {\n    if(type !== \"pm\") {\n      return next()\n    }\n    const sendTo = (type === \"message\") ? channel : user\n    handleMessage(event, user, user, platform, sendTo, text, bp.irc.sendMessage)\n  } else if (platform === \"discord\") {\n    if(type !== \"message\") {\n      return next()\n    }\n    if(!bp.discord.isPrivate(raw) || bp.discord.isSelf(user.id)) {\n      return next()\n    }\n    handleMessage(event, user.id, author, platform, channel.id, text, bp.discord.sendText)\n  } else {\n    throw new Error('Unsupported platform: ', platform)\n  }\n  next()\n}\n\nmodule.exports = {\n  init: function(bp) {\n\n    checkVersion(bp, __dirname)\n    \n    bp.middlewares.register({\n      name: 'rivescript.processIncomingMessages',\n      order: 10,\n      type: 'incoming',\n      module: 'botpress-rivescript',\n      handler: incomingMiddleware,\n      description: 'Processes incoming messages by the RiveScript engine and sends responses'\n    })\n\n    bp.rivescript = {\n      setUtf8: value => {\n        utf8 = value\n        if (rs) {\n          reloadRiveScript()\n        }\n      }\n    }\n  },\n  ready: function(bp) {\n\n    const riveDirectory = path.join(bp.dataLocation, 'rivescript')\n\n    if (!fs.existsSync(riveDirectory)) {\n      fs.mkdirSync(riveDirectory)\n      fs.copySync(path.join(__dirname, '../templates'), riveDirectory)\n    }\n\n    const saveMemory = () => {\n      if (rs && rs.write) {\n        const usersVars = {}\n        const users = _.keys(rs._users)\n        users.forEach(user => {\n          usersVars[user] = rs.getUservars(user)\n        })\n\n        bp.db.kvs.set('__rivescript', usersVars, 'brain')\n      }\n    }\n    const restoreMemory = () => {\n      bp.logger.debug('[rivescript] Restoring brain')\n\n      bp.db.kvs.get('__rivescript', 'brain')\n      .then(content => {\n        if (!content) return\n        const users = _.keys(content)\n        users.forEach(user => rs.setUservars(user, content[user]))\n      })\n    }\n\n    const reloadRiveScript = () => {\n      saveMemory()\n      const isUtf8 = /true|1/i.test(process.env.RIVESCRIPT_UTF8) || utf8\n      if (isUtf8) {\n        bp.logger.debug('[botpress-rivescript]', 'UTF8 mode enabled')\n      }\n      rs = new RiveScript({ utf8: isUtf8 })\n\n      rs.loadDirectory(riveDirectory, (batchNumber) => {\n        rs.sortReplies()\n        restoreMemory()\n      }, (err) => {\n        console.log('Error', err) // TODO clean that\n      })\n\n      calls(rs)\n    }\n\n    reloadRiveScript()\n\n\n    setInterval(saveMemory, 30000)\n    const router = bp.getRouter('botpress-rivescript')\n\n\n    router.get('/scripts', (req, res, next) => {\n      const data = {}\n      const files = fs.readdirSync(riveDirectory)\n      for (let file of files) {\n        const name = file.replace(/\\.rive$/, '')\n        const content = fs.readFileSync(path.join(riveDirectory, file)).toString()\n        data[name] = content\n      }\n      res.send(data)\n    })\n\n    router.delete('/scripts/:name', (req, res, next) => {\n      const { name } = req.params\n\n      if (!name || name.length <= 0 || !validateRiveName(name)) {\n        throw new Error('Invalid rivescript name: ' + name)\n      }\n\n      const filePath = path.join(riveDirectory, name + '.rive')\n\n      if (!fs.existsSync(filePath)) {\n        throw new Error(\"This script doesn't exist\")\n      }\n\n      fs.unlinkSync(filePath)\n\n      reloadRiveScript()\n\n      res.sendStatus(200)\n    })\n\n    // create a new script\n    router.post('/scripts', (req, res, next) => {\n      const { name, content, overwrite } = req.body\n\n      if (!name || name.length <= 0 || !validateRiveName(name)) {\n        throw new Error('Invalid rivescript name: ' + name)\n      }\n\n      const filePath = path.join(riveDirectory, name + '.rive')\n\n      if (!overwrite && fs.existsSync(filePath)) {\n        throw new Error(\"Can't overwrite script: \" + name)\n      }\n\n      fs.writeFileSync(filePath, content)\n\n      reloadRiveScript()\n\n      res.sendStatus(200)\n    })\n\n    router.post('/reset', (req, res, next) => {\n      reloadRiveScript()\n      res.sendStatus(200)\n    })\n\n    router.post('/simulate', (req, res, next) => {\n      const { text } = req.body\n      rs.replyAsync('local-user', text)\n      .then((reply) => {\n        deliveries.forEach(delivery => {\n          if(delivery && delivery.test.test(reply)) {\n            res.send('[Would be delivered by \"' + delivery.name + '\"]: ' + reply)\n            return\n          }\n        })\n        res.send(reply)\n      })\n    })\n\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"botpress-version-manager\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"botpress-version-manager\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"fs-extra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs-extra\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"rivescript\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rivescript\"\n// module id = 6\n// module chunks = 0","import Promise from 'bluebird'\n\nfunction wait(rs, [ms]) {\n  return Promise.delay('', ms)\n}\n\nmodule.exports = (rs) => {\n  rs.setSubroutine('wait', wait)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/calls.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 8\n// module chunks = 0","import _ from 'lodash'\n\nconst jsDelivery = {\n  test: /^js: (.+)/i,\n  name: 'javascript',\n  handler: (match, rs, bp, event, send) => {\n    const body = match[1]\n    const fn = new Function('rs', 'bp', 'event', 'send', body)\n    fn(rs, bp, event, send)\n  }\n}\n\nmodule.exports = [jsDelivery]\n\n\n\n// WEBPACK FOOTER //\n// ./src/deliveries.js"],"sourceRoot":""}